{"remainingRequest":"/Users/marceltanner/Google Drive/Kreativs/Interaktiv/Self Driving/vue_2_selfdriving/node_modules/babel-loader/lib/index.js!/Users/marceltanner/Google Drive/Kreativs/Interaktiv/Self Driving/vue_2_selfdriving/node_modules/cache-loader/dist/cjs.js??ref--1-0!/Users/marceltanner/Google Drive/Kreativs/Interaktiv/Self Driving/vue_2_selfdriving/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/marceltanner/Google Drive/Kreativs/Interaktiv/Self Driving/vue_2_selfdriving/src/App.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/marceltanner/Google Drive/Kreativs/Interaktiv/Self Driving/vue_2_selfdriving/src/App.vue","mtime":1662248704811},{"path":"/Users/marceltanner/Google Drive/Kreativs/Interaktiv/Self Driving/vue_2_selfdriving/babel.config.js","mtime":1644164865878},{"path":"/Users/marceltanner/Google Drive/Kreativs/Interaktiv/Self Driving/vue_2_selfdriving/node_modules/cache-loader/dist/cjs.js","mtime":1644164856547},{"path":"/Users/marceltanner/Google Drive/Kreativs/Interaktiv/Self Driving/vue_2_selfdriving/node_modules/babel-loader/lib/index.js","mtime":1644164857550},{"path":"/Users/marceltanner/Google Drive/Kreativs/Interaktiv/Self Driving/vue_2_selfdriving/node_modules/cache-loader/dist/cjs.js","mtime":1644164856547},{"path":"/Users/marceltanner/Google Drive/Kreativs/Interaktiv/Self Driving/vue_2_selfdriving/node_modules/vue-loader/lib/index.js","mtime":1644164857852}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IF90b0NvbnN1bWFibGVBcnJheSBmcm9tICIvVXNlcnMvbWFyY2VsdGFubmVyL0dvb2dsZSBEcml2ZS9LcmVhdGl2cy9JbnRlcmFrdGl2L1NlbGYgRHJpdmluZy92dWVfMl9zZWxmZHJpdmluZy9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vdG9Db25zdW1hYmxlQXJyYXkuanMiOwppbXBvcnQgX29iamVjdFNwcmVhZCBmcm9tICIvVXNlcnMvbWFyY2VsdGFubmVyL0dvb2dsZSBEcml2ZS9LcmVhdGl2cy9JbnRlcmFrdGl2L1NlbGYgRHJpdmluZy92dWVfMl9zZWxmZHJpdmluZy9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vb2JqZWN0U3ByZWFkMi5qcyI7CmltcG9ydCBfYXN5bmNUb0dlbmVyYXRvciBmcm9tICIvVXNlcnMvbWFyY2VsdGFubmVyL0dvb2dsZSBEcml2ZS9LcmVhdGl2cy9JbnRlcmFrdGl2L1NlbGYgRHJpdmluZy92dWVfMl9zZWxmZHJpdmluZy9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vYXN5bmNUb0dlbmVyYXRvci5qcyI7CmltcG9ydCAicmVnZW5lcmF0b3ItcnVudGltZS9ydW50aW1lLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuc2xpY2UuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5maW5kLmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LnRvLXN0cmluZy5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLmZ1bmN0aW9uLm5hbWUuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5zb3J0LmpzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmlsbC5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnJlZ2V4cC50by1zdHJpbmcuanMiOwoKLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KdmFyIHRmID0gcmVxdWlyZSgnQHRlbnNvcmZsb3cvdGZqcycpOwoKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICdBcHAnLAogIGRhdGE6IGZ1bmN0aW9uIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBjdHg6IG51bGwsCiAgICAgIHdvcmxkV2lkdGg6IDI1NiwKICAgICAgd29ybGRIZWlnaHQ6IDI1NiwKICAgICAgaW1nV29ybGQ6IG51bGwsCiAgICAgIHdvcmxkTG9hZGVkOiBmYWxzZSwKICAgICAgZnBzOiBudWxsLAogICAgICBmcHNDb3VudGVyOiBudWxsLAogICAgICB0aWNrOiB0cnVlLAogICAgICB0aWNrVGltZTogbnVsbCwKICAgICAgZHVyYXRpb246IC0xLAogICAgICBkdXJhdGlvblN0cmluZzogbnVsbCwKICAgICAgY2FyOiB7CiAgICAgICAgd2lkdGg6IDgsCiAgICAgICAgbGVuZ3RoOiAxNiwKICAgICAgICB4OiAyNTYgLyAyICogMC4yNSwKICAgICAgICB5OiAyNTYgLyAyICogMS41LAogICAgICAgIHNwZWVkOiAwLjUsCiAgICAgICAgc3RlZXJpbmdTcGVlZDogMC4wMjUsCiAgICAgICAgYW5nbGU6IDAKICAgICAgfSwKICAgICAgdmlld1NpemU6IDMyLAogICAgICB2aWV3UmVkdWN0aW9uOiAzLAogICAgICB2aWV3UmVkdWNlZFNpemU6IG51bGwsCiAgICAgIHZpZXdQaXhlbHM6IG51bGwsCiAgICAgIHN0ZWVyaW5nOiBudWxsLAogICAgICBzYW1wbGVzOiBbXSwKICAgICAgc2FtcGxlc01heExlbmd0aDogNDA5NiwKICAgICAgdHJhaW5pbmdTYW1wbGVzOiBudWxsLAogICAgICB0cmFpbmluZ1NhbXBsZXNNYXhMZW5ndGg6IDQwOTYsCiAgICAgIGJhZFJld2FyZHM6IDAsCiAgICAgIGJhZFJld2FyZHNJbkFSb3c6IDAsCiAgICAgIHNjb3JlOiAwLAogICAgICBsYXN0U2NvcmU6IG51bGwsCiAgICAgIGhpZ2hzY29yZXM6IFtdLAogICAgICBoaWdoc2NvcmVzTWF4TGVuZ3RoOiAxMCwKICAgICAgaGlnaHNjb3Jlc01heFNob3duOiAxMCwKICAgICAgdHJhaW5pbmc6IGZhbHNlLAogICAgICB0cmFpbmluZ1Byb2dyZXNzOiAwLAogICAgICBtb2RlbHM6IHVuZGVmaW5lZCwKICAgICAgbnVtYmVyT2ZNb2RlbHM6IDEwLAogICAgICBtb2RlbEluZGV4OiAwCiAgICB9OwogIH0sCiAgY29tcHV0ZWQ6IHsKICAgIHJlZHVjZWRWaWV3U2l6ZTogZnVuY3Rpb24gcmVkdWNlZFZpZXdTaXplKCkgewogICAgICB2YXIgcmVkdWNlZFNpemUgPSB0aGlzLnZpZXdTaXplOwoKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnZpZXdSZWR1Y3Rpb247IGkrKykgewogICAgICAgIHJlZHVjZWRTaXplID0gcmVkdWNlZFNpemUgLyAyOwogICAgICB9CgogICAgICByZXR1cm4gcmVkdWNlZFNpemU7CiAgICB9LAogICAgaGlnaHNjb3Jlc1Nob3duOiBmdW5jdGlvbiBoaWdoc2NvcmVzU2hvd24oKSB7CiAgICAgIHJldHVybiB0aGlzLmhpZ2hzY29yZXMuc2xpY2UoMCwgdGhpcy5oaWdoc2NvcmVzTWF4U2hvd24pOwogICAgfQogIH0sCiAgbW91bnRlZDogZnVuY3Rpb24gbW91bnRlZCgpIHsKICAgIHRoaXMuY3R4ID0gdGhpcy4kcmVmcy5jYW52YXMuZ2V0Q29udGV4dCgiMmQiKTsKICAgIHRoaXMuaW1nV29ybGQgPSBuZXcgSW1hZ2UodGhpcy53b3JsZFdpZHRoLCB0aGlzLndvcmxkSGVpZ2h0KTsKICAgIHRoaXMuaW1nV29ybGQuc3JjID0gcmVxdWlyZSgnL3NyYy9hc3NldHMvd29ybGQ0LmpwZycpOwogICAgdmFyIGFwcCA9IHRoaXM7CgogICAgdGhpcy5pbWdXb3JsZC5vbmxvYWQgPSBmdW5jdGlvbiAoKSB7CiAgICAgIGFwcC53b3JsZExvYWRlZCA9IHRydWU7CiAgICB9OyAvL2RvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCB0aGlzLmtleURvd24pOwogICAgLy9kb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdrZXl1cCcsIHRoaXMua2V5VXApOwoKCiAgICB0aGlzLmN0eFZpZXdTbmFwc2hvdCA9IHRoaXMuJHJlZnMudmlld1NuYXBzaG90Q2FudmFzLmdldENvbnRleHQoIjJkIik7CiAgICB0aGlzLmN0eENhclNuYXBzaG90ID0gdGhpcy4kcmVmcy5jYXJTbmFwc2hvdENhbnZhcy5nZXRDb250ZXh0KCIyZCIpOwogICAgdGhpcy5jdHhDYXIgPSB0aGlzLiRyZWZzLmNhckNhbnZhcy5nZXRDb250ZXh0KCIyZCIpOwogICAgdGhpcy5jdHhWaWV3ID0gdGhpcy4kcmVmcy52aWV3Q2FudmFzLmdldENvbnRleHQoIjJkIik7CiAgICB0aGlzLmN0eFZpZXdSZWR1Y2VkID0gdGhpcy4kcmVmcy52aWV3Q2FudmFzUmVkdWNlZC5nZXRDb250ZXh0KCIyZCIpOwogICAgdGhpcy5jdHhTdGF0cyA9IHRoaXMuJHJlZnMuc3RhdHNDYW52YXMuZ2V0Q29udGV4dCgiMmQiKTsKICAgIHRoaXMudmlld1JlZHVjZWRTaXplID0gdGhpcy52aWV3U2l6ZTsKCiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMudmlld1JlZHVjdGlvbjsgaSsrKSB7CiAgICAgIHRoaXMudmlld1JlZHVjZWRTaXplID0gdGhpcy52aWV3UmVkdWNlZFNpemUgLyAyOwogICAgfQoKICAgIHRoaXMubW9kZWxzID0gbmV3IEFycmF5KHRoaXMubnVtYmVyT2ZNb2RlbHMpOwogICAgdGhpcy5jcmVhdGVNb2RlbCh0aGlzLm1vZGVsSW5kZXgpOwogICAgdGhpcy5yZWZyZXNoTG9vcCgpOwogIH0sCiAgbWV0aG9kczogewogICAgY3JlYXRlTW9kZWw6IGZ1bmN0aW9uIGNyZWF0ZU1vZGVsKG1vZGVsSW5kZXgpIHsKICAgICAgY29uc29sZS5sb2coImNyZWF0aW5nIG1vZGVsIC4uLiIpOwogICAgICB2YXIgbnVtYmVyT2ZMYXllcnMgPSAyICsgTWF0aC5yb3VuZChNYXRoLnJhbmRvbSgpKTsKICAgICAgdmFyIGxheWVycyA9IG5ldyBBcnJheShudW1iZXJPZkxheWVycyk7CgogICAgICBmb3IgKHZhciBpID0gbnVtYmVyT2ZMYXllcnMgLSAxOyBpID49IDA7IGktLSkgewogICAgICAgIGlmIChpID09PSBudW1iZXJPZkxheWVycyAtIDEpIHsKICAgICAgICAgIC8vIGxhc3QgbGF5ZXIKICAgICAgICAgIGxheWVyc1tpXSA9IHsKICAgICAgICAgICAgdW5pdHM6IDEsCiAgICAgICAgICAgIGFjdGl2YXRpb246ICJzaWdtb2lkIgogICAgICAgICAgfTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgbGF5ZXJzW2ldID0gewogICAgICAgICAgICB1bml0czogMyArIE1hdGguY2VpbChNYXRoLnJhbmRvbSgpICogMTUpLAogICAgICAgICAgICBhY3RpdmF0aW9uOiBbInJlbHUiLCAic2lnbW9pZCJdW01hdGgucm91bmQoTWF0aC5yYW5kb20oKSldCiAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy5tb2RlbHNbbW9kZWxJbmRleF0gPSB7CiAgICAgICAgbGF5ZXJzOiBsYXllcnMsCiAgICAgICAgdHJhaW5pbmdzOiAwLAogICAgICAgIGhpZ2hzY29yZTogdW5kZWZpbmVkLAogICAgICAgIG5hbWU6IG1vZGVsSW5kZXggKyAxLAogICAgICAgIGNoaWxkcmVuOiAwCiAgICAgIH07IC8vIGNyZWF0ZSBtb2RlbCB3aXRoIGxheWVycwoKICAgICAgdGhpcy5tb2RlbHNbbW9kZWxJbmRleF0ubW9kZWwgPSB0Zi5zZXF1ZW50aWFsKCk7CgogICAgICBmb3IgKHZhciBfaSA9IDA7IF9pIDwgbGF5ZXJzLmxlbmd0aDsgX2krKykgewogICAgICAgIGlmIChfaSA9PT0gMCkgewogICAgICAgICAgLy8gZmlyc3QgbGF5ZXIKICAgICAgICAgIHRoaXMubW9kZWxzW21vZGVsSW5kZXhdLm1vZGVsLmFkZCh0Zi5sYXllcnMuZGVuc2UoewogICAgICAgICAgICBpbnB1dFNoYXBlOiB0aGlzLnZpZXdSZWR1Y2VkU2l6ZSAqIHRoaXMudmlld1JlZHVjZWRTaXplLAogICAgICAgICAgICBhY3RpdmF0aW9uOiBsYXllcnNbX2ldLmFjdGl2YXRpb24sCiAgICAgICAgICAgIHVuaXRzOiBsYXllcnNbX2ldLnVuaXRzCiAgICAgICAgICB9KSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMubW9kZWxzW21vZGVsSW5kZXhdLm1vZGVsLmFkZCh0Zi5sYXllcnMuZGVuc2UoewogICAgICAgICAgICBhY3RpdmF0aW9uOiBsYXllcnNbX2ldLmFjdGl2YXRpb24sCiAgICAgICAgICAgIHVuaXRzOiBsYXllcnNbX2ldLnVuaXRzCiAgICAgICAgICB9KSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIC8qCiAgICAgIHRoaXMubW9kZWxzW2ldLm1vZGVsLmFkZCh0Zi5sYXllcnMuZGVuc2Uoe2lucHV0U2hhcGU6IHRoaXMudmlld1JlZHVjZWRTaXplKnRoaXMudmlld1JlZHVjZWRTaXplLCBhY3RpdmF0aW9uOiAicmVsdSIsIHVuaXRzOiAxMH0pKTsKICAgICAgdGhpcy5tb2RlbHNbaV0ubW9kZWwuYWRkKHRmLmxheWVycy5kZW5zZSh7YWN0aXZhdGlvbjogInJlbHUiLCB1bml0czogNX0pKTsKICAgICAgdGhpcy5tb2RlbHNbaV0ubW9kZWwuYWRkKHRmLmxheWVycy5kZW5zZSh7YWN0aXZhdGlvbjogInNpZ21vaWQiLCB1bml0czogMX0pKTsKICAgICAgKi8KICAgICAgLy90aGlzLm1vZGVsc1tpXS5hZGQodGYubGF5ZXJzLmRlbnNlKHthY3RpdmF0aW9uOiAicmVsdSIsIHVuaXRzOiAxfSkpOwoKCiAgICAgIHRoaXMubW9kZWxzW21vZGVsSW5kZXhdLm1vZGVsLmNvbXBpbGUoewogICAgICAgIGxvc3M6ICdiaW5hcnlDcm9zc2VudHJvcHknLAogICAgICAgIG9wdGltaXplcjogdGYudHJhaW4ucm1zcHJvcCgwLjEpLAogICAgICAgIG1ldHJpY3M6IFsnYWNjdXJhY3knXQogICAgICB9KTsgLy90aGlzLm1vZGVsLmNvbXBpbGUoe2xvc3M6J2NhdGVnb3JpY2FsQ3Jvc3NlbnRyb3B5JyxvcHRpbWl6ZXI6dGYudHJhaW4uYWRhbSgpLG1ldHJpY3M6WydhY2N1cmFjeSddfSk7CiAgICB9LAogICAgdHJhaW46IGZ1bmN0aW9uIHRyYWluKCkgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgcmV0dXJuIF9hc3luY1RvR2VuZXJhdG9yKCAvKiNfX1BVUkVfXyovcmVnZW5lcmF0b3JSdW50aW1lLm1hcmsoZnVuY3Rpb24gX2NhbGxlZSgpIHsKICAgICAgICB2YXIgaGlnaHNjb3JlT2ZNb2RlbCwgX2hpZ2hzY29yZU9mTW9kZWwsIHJhbmRvbSwgaGlnaHNjb3JlSW5kZXgsIG1vdGhlciwgaSwgX3RoaXMkdHJhaW5pbmdTYW1wbGVzLCBzYW1wbGVzLCBqLCBmZWF0dXJlVmFsdWVzVHJhaW5pbmcsIGxhYmVsVmFsdWVzVHJhaW5pbmcsIF9pMiwgZmVhdHVyZVZhbHVlVHJhaW5pbmcsIGZlYXR1cmVUZW5zb3JUcmFpbmluZywgbGFiZWxUZW5zb3JUcmFpbmluZzsKCiAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS53cmFwKGZ1bmN0aW9uIF9jYWxsZWUkKF9jb250ZXh0KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0LnByZXYgPSBfY29udGV4dC5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgLy8gY2hlY2sgaWYgbmV3IGhpZ2hzY29yZToKICAgICAgICAgICAgICAgIGhpZ2hzY29yZU9mTW9kZWwgPSBfdGhpcy5oaWdoc2NvcmVzLmZpbmQoZnVuY3Rpb24gKGVsKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBlbC5tb2RlbEluZGV4ID09PSBfdGhpcy5tb2RlbEluZGV4OwogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgaWYgKGhpZ2hzY29yZU9mTW9kZWwpIHsKICAgICAgICAgICAgICAgICAgX3RoaXMubW9kZWxzW190aGlzLm1vZGVsSW5kZXhdLmhpZ2hzY29yZSA9IGhpZ2hzY29yZU9mTW9kZWwuc2NvcmU7CiAgICAgICAgICAgICAgICB9IC8vIHN3aXRjaCB0byBuZXh0IG1vZGVsCgoKICAgICAgICAgICAgICAgIF90aGlzLm1vZGVsSW5kZXggPSAoX3RoaXMubW9kZWxJbmRleCArIDEpICUgX3RoaXMubnVtYmVyT2ZNb2RlbHM7IC8vIGNyZWF0ZSBvciBtYWtlIGNsb25lLCBpZiBuZWNlc3NhcnkKCiAgICAgICAgICAgICAgICBpZiAoIV90aGlzLm1vZGVsc1tfdGhpcy5tb2RlbEluZGV4XSkgewogICAgICAgICAgICAgICAgICBfdGhpcy5jcmVhdGVNb2RlbChfdGhpcy5tb2RlbEluZGV4KTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIC8vIGNoZWNrIGZvciBuZXcgaGlnaHNjb3JlCiAgICAgICAgICAgICAgICAgIF9oaWdoc2NvcmVPZk1vZGVsID0gX3RoaXMuaGlnaHNjb3Jlcy5maW5kKGZ1bmN0aW9uIChlbCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBlbC5tb2RlbEluZGV4ID09PSBfdGhpcy5tb2RlbEluZGV4OwogICAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICAgIGlmICghX2hpZ2hzY29yZU9mTW9kZWwpIHsKICAgICAgICAgICAgICAgICAgICAvLyByZXBsYWNlIG1vZGVsCiAgICAgICAgICAgICAgICAgICAgcmFuZG9tID0gTWF0aC5yYW5kb20oKTsKCiAgICAgICAgICAgICAgICAgICAgaWYgKHJhbmRvbSA+IDEgLSAwLjE4MikgewogICAgICAgICAgICAgICAgICAgICAgaGlnaHNjb3JlSW5kZXggPSAwOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocmFuZG9tID4gMSAtIDAuMTgyIC0gMC4xNjMpIHsKICAgICAgICAgICAgICAgICAgICAgIGhpZ2hzY29yZUluZGV4ID0gMTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJhbmRvbSA+IDEgLSAwLjE4MiAtIDAuMTYzIC0gMC4xNDYpIHsKICAgICAgICAgICAgICAgICAgICAgIGhpZ2hzY29yZUluZGV4ID0gMjsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJhbmRvbSA+IDEgLSAwLjE4MiAtIDAuMTYzIC0gMC4xNDYgLSAwLjEyNykgewogICAgICAgICAgICAgICAgICAgICAgaGlnaHNjb3JlSW5kZXggPSAzOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocmFuZG9tID4gMSAtIDAuMTgyIC0gMC4xNjMgLSAwLjE0NiAtIDAuMTI3IC0gMC4xMDkpIHsKICAgICAgICAgICAgICAgICAgICAgIGhpZ2hzY29yZUluZGV4ID0gNDsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJhbmRvbSA+IDEgLSAwLjE4MiAtIDAuMTYzIC0gMC4xNDYgLSAwLjEyNyAtIDAuMTA5IC0gMC4wOTEpIHsKICAgICAgICAgICAgICAgICAgICAgIGhpZ2hzY29yZUluZGV4ID0gNTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJhbmRvbSA+IDEgLSAwLjE4MiAtIDAuMTYzIC0gMC4xNDYgLSAwLjEyNyAtIDAuMTA5IC0gMC4wOTEgLSAwLjA3MykgewogICAgICAgICAgICAgICAgICAgICAgaGlnaHNjb3JlSW5kZXggPSA2OwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocmFuZG9tID4gMSAtIDAuMTgyIC0gMC4xNjMgLSAwLjE0NiAtIDAuMTI3IC0gMC4xMDkgLSAwLjA5MSAtIDAuMDczIC0gMC4wNTQpIHsKICAgICAgICAgICAgICAgICAgICAgIGhpZ2hzY29yZUluZGV4ID0gNzsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJhbmRvbSA+IDEgLSAwLjE4MiAtIDAuMTYzIC0gMC4xNDYgLSAwLjEyNyAtIDAuMTA5IC0gMC4wOTEgLSAwLjA3MyAtIDAuMDU0IC0gMC4wMzcpIHsKICAgICAgICAgICAgICAgICAgICAgIGhpZ2hzY29yZUluZGV4ID0gODsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJhbmRvbSA+IDEgLSAwLjE4MiAtIDAuMTYzIC0gMC4xNDYgLSAwLjEyNyAtIDAuMTA5IC0gMC4wOTEgLSAwLjA3MyAtIDAuMDU0IC0gMC4wMzcgLSAwLjAxOCkgewogICAgICAgICAgICAgICAgICAgICAgaGlnaHNjb3JlSW5kZXggPSA5OwogICAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgICAgbW90aGVyID0gX3RoaXMubW9kZWxzW190aGlzLmhpZ2hzY29yZXNbaGlnaHNjb3JlSW5kZXhdLm1vZGVsSW5kZXhdOwogICAgICAgICAgICAgICAgICAgIF90aGlzLm1vZGVsc1tfdGhpcy5tb2RlbEluZGV4XSA9IF9vYmplY3RTcHJlYWQoe30sIG1vdGhlcik7CiAgICAgICAgICAgICAgICAgICAgX3RoaXMubW9kZWxzW190aGlzLm1vZGVsSW5kZXhdLnRyYWluaW5ncyA9IDA7CiAgICAgICAgICAgICAgICAgICAgX3RoaXMubW9kZWxzW190aGlzLm1vZGVsSW5kZXhdLmhpZ2hzY29yZSA9IHVuZGVmaW5lZDsKICAgICAgICAgICAgICAgICAgICBtb3RoZXIuY2hpbGRyZW4rKzsKICAgICAgICAgICAgICAgICAgICBfdGhpcy5tb2RlbHNbX3RoaXMubW9kZWxJbmRleF0ubmFtZSA9IG1vdGhlci5uYW1lICsgIi4iICsgbW90aGVyLmNoaWxkcmVuOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgX3RoaXMudHJhaW5pbmcgPSB0cnVlOwogICAgICAgICAgICAgICAgX3RoaXMudHJhaW5pbmdTYW1wbGVzID0gW107CgogICAgICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IF90aGlzLmhpZ2hzY29yZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgICAgICAgc2FtcGxlcyA9IFtdOwoKICAgICAgICAgICAgICAgICAgZm9yIChqID0gMDsgaiA8IF90aGlzLmhpZ2hzY29yZXNbaV0uc2FtcGxlcy5sZW5ndGg7IGorKykgewogICAgICAgICAgICAgICAgICAgIGlmIChfdGhpcy5oaWdoc2NvcmVzW2ldLnNhbXBsZXNbal0ucmV3YXJkID4gMC41KSB7CiAgICAgICAgICAgICAgICAgICAgICAvLyB1c2Ugb25seSBnb29kIHJld2FyZHMKICAgICAgICAgICAgICAgICAgICAgIHNhbXBsZXMucHVzaChfdGhpcy5oaWdoc2NvcmVzW2ldLnNhbXBsZXNbal0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgKF90aGlzJHRyYWluaW5nU2FtcGxlcyA9IF90aGlzLnRyYWluaW5nU2FtcGxlcykucHVzaC5hcHBseShfdGhpcyR0cmFpbmluZ1NhbXBsZXMsIHNhbXBsZXMpOwogICAgICAgICAgICAgICAgfSAvLyByYW5kb21pc2UgYW5kIHNsaWNlCgoKICAgICAgICAgICAgICAgIF90aGlzLnRyYWluaW5nU2FtcGxlcy5zb3J0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIDAuNSAtIE1hdGgucmFuZG9tKCk7CiAgICAgICAgICAgICAgICB9KTsKCiAgICAgICAgICAgICAgICBfdGhpcy50cmFpbmluZ1NhbXBsZXMgPSBfdGhpcy50cmFpbmluZ1NhbXBsZXMuc2xpY2UoMCwgX3RoaXMudHJhaW5pbmdTYW1wbGVzTWF4TGVuZ3RoKTsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJ0b3RhbCBudW1iZXIgb2Ygc2FtcGxlczogIiArIF90aGlzLnRyYWluaW5nU2FtcGxlcy5sZW5ndGgpOwogICAgICAgICAgICAgICAgZmVhdHVyZVZhbHVlc1RyYWluaW5nID0gW107CiAgICAgICAgICAgICAgICBsYWJlbFZhbHVlc1RyYWluaW5nID0gW107CgogICAgICAgICAgICAgICAgZm9yIChfaTIgPSAwOyBfaTIgPCBfdGhpcy50cmFpbmluZ1NhbXBsZXMubGVuZ3RoOyBfaTIrKykgewogICAgICAgICAgICAgICAgICBmZWF0dXJlVmFsdWVUcmFpbmluZyA9IF90b0NvbnN1bWFibGVBcnJheShfdGhpcy50cmFpbmluZ1NhbXBsZXNbX2kyXS5zdGF0ZSk7IC8vZmVhdHVyZVZhbHVlVHJhaW5pbmcucHVzaCggdGhpcy50cmFpbmluZ1NhbXBsZXNbaV0ucmV3YXJkICk7CgogICAgICAgICAgICAgICAgICBmZWF0dXJlVmFsdWVzVHJhaW5pbmcucHVzaChmZWF0dXJlVmFsdWVUcmFpbmluZyk7CiAgICAgICAgICAgICAgICAgIGxhYmVsVmFsdWVzVHJhaW5pbmcucHVzaChfdGhpcy50cmFpbmluZ1NhbXBsZXNbX2kyXS5hY3Rpb24pOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGZlYXR1cmVUZW5zb3JUcmFpbmluZyA9IHRmLnRlbnNvcjJkKGZlYXR1cmVWYWx1ZXNUcmFpbmluZywgW2ZlYXR1cmVWYWx1ZXNUcmFpbmluZy5sZW5ndGgsIGZlYXR1cmVWYWx1ZXNUcmFpbmluZ1swXS5sZW5ndGhdKTsKICAgICAgICAgICAgICAgIGxhYmVsVGVuc29yVHJhaW5pbmcgPSB0Zi50ZW5zb3IyZChsYWJlbFZhbHVlc1RyYWluaW5nLCBbbGFiZWxWYWx1ZXNUcmFpbmluZy5sZW5ndGgsIDFdKTsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJ0cmFpbiBtb2RlbCAuLi4iKTsKICAgICAgICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSAxODsKICAgICAgICAgICAgICAgIHJldHVybiBfdGhpcy50cmFpbk1vZGVsKF90aGlzLm1vZGVsSW5kZXgsIGZlYXR1cmVUZW5zb3JUcmFpbmluZywgbGFiZWxUZW5zb3JUcmFpbmluZywgTWF0aC5taW4oMTAsIF90aGlzLnRyYWluaW5nU2FtcGxlc01heExlbmd0aCAvIF90aGlzLnRyYWluaW5nU2FtcGxlcy5sZW5ndGgpICogMTApOwoKICAgICAgICAgICAgICBjYXNlIDE4OgogICAgICAgICAgICAgICAgX3RoaXMudHJhaW5pbmcgPSBmYWxzZTsKICAgICAgICAgICAgICAgIF90aGlzLnRyYWluaW5nUHJvZ3Jlc3MgPSAwOwogICAgICAgICAgICAgICAgX3RoaXMubW9kZWxzW190aGlzLm1vZGVsSW5kZXhdLnRyYWluaW5ncyArPSAxOwoKICAgICAgICAgICAgICBjYXNlIDIxOgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQuc3RvcCgpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSwgX2NhbGxlZSk7CiAgICAgIH0pKSgpOwogICAgfSwKICAgIHRyYWluTW9kZWw6IGZ1bmN0aW9uIHRyYWluTW9kZWwobW9kZWxJbmRleCwgZmVhdHVyZVRlbnNvclRyYWluaW5nLCBsYWJlbFRlbnNvclRyYWluaW5nLCBlcG9jaHMpIHsKICAgICAgdmFyIF90aGlzMiA9IHRoaXM7CgogICAgICByZXR1cm4gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMigpIHsKICAgICAgICB2YXIgcmVmOwogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlMiQoX2NvbnRleHQyKSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0Mi5wcmV2ID0gX2NvbnRleHQyLm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICByZWYgPSBfdGhpczI7CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQyLmFicnVwdCgicmV0dXJuIiwgX3RoaXMyLm1vZGVsc1ttb2RlbEluZGV4XS5tb2RlbC5maXQoZmVhdHVyZVRlbnNvclRyYWluaW5nLCBsYWJlbFRlbnNvclRyYWluaW5nLCB7CiAgICAgICAgICAgICAgICAgIGVwb2NoczogZXBvY2hzLAogICAgICAgICAgICAgICAgICAvL3ZhbGlkYXRpb25TcGxpdDogMC4yLAogICAgICAgICAgICAgICAgICBjYWxsYmFja3M6IHsKICAgICAgICAgICAgICAgICAgICBvbkVwb2NoRW5kOiBmdW5jdGlvbiBvbkVwb2NoRW5kKGVwb2NoKSB7CiAgICAgICAgICAgICAgICAgICAgICByZWYudHJhaW5pbmdQcm9ncmVzcyA9IE1hdGgucm91bmQoZXBvY2ggLyBlcG9jaHMgKiAxMDApOwogICAgICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICAgICAgb25UcmFpbkVuZDogZnVuY3Rpb24gb25UcmFpbkVuZCgpIHsKICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJkb25lIik7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KSk7CgogICAgICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgICBjYXNlICJlbmQiOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0Mi5zdG9wKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9LCBfY2FsbGVlMik7CiAgICAgIH0pKSgpOwogICAgfSwKICAgIHByZWRpY3Q6IGZ1bmN0aW9uIHByZWRpY3QobW9kZWxJbmRleCwgaW5wdXQpIHsKICAgICAgdmFyIF90aGlzMyA9IHRoaXM7CgogICAgICByZXR1cm4gX2FzeW5jVG9HZW5lcmF0b3IoIC8qI19fUFVSRV9fKi9yZWdlbmVyYXRvclJ1bnRpbWUubWFyayhmdW5jdGlvbiBfY2FsbGVlMygpIHsKICAgICAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZTMkKF9jb250ZXh0MykgewogICAgICAgICAgd2hpbGUgKDEpIHsKICAgICAgICAgICAgc3dpdGNoIChfY29udGV4dDMucHJldiA9IF9jb250ZXh0My5uZXh0KSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0My5hYnJ1cHQoInJldHVybiIsIHRmLnRpZHkoZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICB2YXIgaW5wdXRUZW5zb3IgPSB0Zi50ZW5zb3IyZChbaW5wdXRdLCBbMSwgX3RoaXMzLnZpZXdSZWR1Y2VkU2l6ZSAqIF90aGlzMy52aWV3UmVkdWNlZFNpemVdKTsKCiAgICAgICAgICAgICAgICAgIHZhciBvdXRwdXRUZW5zb3IgPSBfdGhpczMubW9kZWxzW21vZGVsSW5kZXhdLm1vZGVsLnByZWRpY3QoaW5wdXRUZW5zb3IpOwoKICAgICAgICAgICAgICAgICAgdmFyIG91dHB1dFZhbHVlID0gb3V0cHV0VGVuc29yLmRhdGFTeW5jKCk7CiAgICAgICAgICAgICAgICAgIHJldHVybiBvdXRwdXRWYWx1ZTsKICAgICAgICAgICAgICAgIH0pKTsKCiAgICAgICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQzLnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWUzKTsKICAgICAgfSkpKCk7CiAgICB9LAogICAgZ2V0U3RlZXJpbmc6IGZ1bmN0aW9uIGdldFN0ZWVyaW5nKCkgewogICAgICB2YXIgX3RoaXM0ID0gdGhpczsKCiAgICAgIHJldHVybiBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWU0KCkgewogICAgICAgIHJldHVybiByZWdlbmVyYXRvclJ1bnRpbWUud3JhcChmdW5jdGlvbiBfY2FsbGVlNCQoX2NvbnRleHQ0KSB7CiAgICAgICAgICB3aGlsZSAoMSkgewogICAgICAgICAgICBzd2l0Y2ggKF9jb250ZXh0NC5wcmV2ID0gX2NvbnRleHQ0Lm5leHQpIHsKICAgICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgICBfY29udGV4dDQubmV4dCA9IDI7CiAgICAgICAgICAgICAgICByZXR1cm4gX3RoaXM0LnByZWRpY3QoX3RoaXM0Lm1vZGVsSW5kZXgsIF90aGlzNC50ZXN0aW5nRGF0YUlucHV0KTsKCiAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgX3RoaXM0LnByZWRpY3Rpb24gPSBfY29udGV4dDQuc2VudDsKICAgICAgICAgICAgICAgIF90aGlzNC5wcmVkaWN0aW9uID0gTWF0aC5tYXgoMCwgX3RoaXM0LnByZWRpY3Rpb24pOwogICAgICAgICAgICAgICAgcmV0dXJuIF9jb250ZXh0NC5hYnJ1cHQoInJldHVybiIsIF90aGlzNC5wcmVkaWN0aW9uKTsKCiAgICAgICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgICAgICByZXR1cm4gX2NvbnRleHQ0LnN0b3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0sIF9jYWxsZWU0KTsKICAgICAgfSkpKCk7CiAgICB9LAogICAgcmVmcmVzaExvb3A6IGZ1bmN0aW9uIHJlZnJlc2hMb29wKCkgewogICAgICB2YXIgX3RoaXM1ID0gdGhpczsKCiAgICAgIHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUoZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBub3cgPSBwZXJmb3JtYW5jZS5ub3coKTsKCiAgICAgICAgaWYgKF90aGlzNS50aWNrKSB7CiAgICAgICAgICBfdGhpczUudGlja1RpbWUgPSBub3c7CiAgICAgICAgICBfdGhpczUuZnBzID0gX3RoaXM1LmZwc0NvdW50ZXI7CiAgICAgICAgICBfdGhpczUuZnBzQ291bnRlciA9IDA7CiAgICAgICAgICBfdGhpczUudGljayA9IGZhbHNlOwogICAgICAgICAgX3RoaXM1LmR1cmF0aW9uKys7CiAgICAgICAgICB2YXIgZGF0ZSA9IG5ldyBEYXRlKDApOwogICAgICAgICAgZGF0ZS5zZXRTZWNvbmRzKF90aGlzNS5kdXJhdGlvbik7IC8vIHNwZWNpZnkgdmFsdWUgZm9yIFNFQ09ORFMgaGVyZQoKICAgICAgICAgIF90aGlzNS5kdXJhdGlvblN0cmluZyA9IGRhdGUudG9JU09TdHJpbmcoKS5zdWJzdHIoMTEsIDgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBfdGhpczUuZnBzQ291bnRlcisrOwoKICAgICAgICAgIGlmIChub3cgPj0gX3RoaXM1LnRpY2tUaW1lICsgMTAwMCkgewogICAgICAgICAgICBfdGhpczUudGljayA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBfdGhpczUuZW50ZXJGcmFtZSgpOwoKICAgICAgICBfdGhpczUucmVmcmVzaExvb3AoKTsKICAgICAgfSk7CiAgICB9LAogICAgZW50ZXJGcmFtZTogZnVuY3Rpb24gZW50ZXJGcmFtZSgpIHsKICAgICAgaWYgKHRoaXMud29ybGRMb2FkZWQgJiYgIXRoaXMudHJhaW5pbmcpIHsKICAgICAgICB0aGlzLmRyYXdXb3JsZCgpOwogICAgICAgIHRoaXMuZ2V0VmlldygpOwogICAgICAgIHRoaXMubW92ZUNhcigpOwogICAgICB9CiAgICB9LAogICAgZHJhd1N0YXRzOiBmdW5jdGlvbiBkcmF3U3RhdHMoKSB7CiAgICAgIHRoaXMuY3R4U3RhdHMuY2xlYXJSZWN0KDAsIDAsIHRoaXMuY3R4U3RhdHMuY2FudmFzLndpZHRoLCB0aGlzLmN0eFN0YXRzLmNhbnZhcy5oZWlnaHQpOyAvL3RoaXMuY3R4U3RhdHMuZmlsbFJlY3QoMCwgMCwgdGhpcy5jdHhTdGF0cy5jYW52YXMud2lkdGgsIHRoaXMuY3R4U3RhdHMuY2FudmFzLmhlaWdodCk7CiAgICAgIC8vdGhpcy5jdHhTdGF0cy5zdHJva2VTdHlsZSA9ICIjZmZmZmZmIjsKCiAgICAgIHZhciBudW1iZXJPZnNhbXBsZXNEcmF3biA9IE1hdGgubWluKDUxMiwgdGhpcy5zYW1wbGVzLmxlbmd0aCk7CgogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG51bWJlck9mc2FtcGxlc0RyYXduOyBpKyspIHsKICAgICAgICAvKgogICAgICAgIHRoaXMuY3R4U3RhdHMubW92ZVRvKCB0aGlzLnNhbXBsZXNbaV0uYWN0aW9uICogdGhpcy5jdHhTdGF0cy5jYW52YXMud2lkdGgsIHRoaXMuY3R4U3RhdHMuY2FudmFzLmhlaWdodC90aGlzLnNhbXBsZXMubGVuZ3RoICogaSApOwogICAgICAgIHRoaXMuY3R4U3RhdHMubGluZVRvKCB0aGlzLnNhbXBsZXNbaSsxXS5hY3Rpb24gKiB0aGlzLmN0eFN0YXRzLmNhbnZhcy53aWR0aCwgdGhpcy5jdHhTdGF0cy5jYW52YXMuaGVpZ2h0L3RoaXMuc2FtcGxlcy5sZW5ndGggKiAoaSsxKSApOwogICAgICAgICovCiAgICAgICAgdGhpcy5jdHhTdGF0cy5iZWdpblBhdGgoKTsKICAgICAgICB0aGlzLmN0eFN0YXRzLmZpbGxTdHlsZSA9ICIjZmZmZmZmIjsKICAgICAgICB0aGlzLmN0eFN0YXRzLmFyYyh0aGlzLnNhbXBsZXNbaV0uYWN0aW9uUHJlZGljdGVkICogdGhpcy5jdHhTdGF0cy5jYW52YXMud2lkdGgsIHRoaXMuY3R4U3RhdHMuY2FudmFzLmhlaWdodCAvIG51bWJlck9mc2FtcGxlc0RyYXduICogaSwgMSwgMCwgMiAqIE1hdGguUEkpOwogICAgICAgIHRoaXMuY3R4U3RhdHMuZmlsbCgpOwogICAgICAgIHRoaXMuY3R4U3RhdHMuYmVnaW5QYXRoKCk7CiAgICAgICAgdmFyIHJnYiA9IHZvaWQgMDsKCiAgICAgICAgaWYgKHRoaXMuc2FtcGxlc1tpXS5yZXdhcmQgPj0gMC41KSB7CiAgICAgICAgICAvL3JnYiA9ICIjMDBmZjAwIjsKICAgICAgICAgIHJnYiA9ICIjMDAiICsgTWF0aC5yb3VuZCh0aGlzLnNhbXBsZXNbaV0ucmV3YXJkICogMjU1KS50b1N0cmluZygxNikgKyAiMDAiOwogICAgICAgICAgdGhpcy5jdHhTdGF0cy5maWxsU3R5bGUgPSByZ2I7CiAgICAgICAgICB0aGlzLmN0eFN0YXRzLmFyYyh0aGlzLnNhbXBsZXNbaV0uYWN0aW9uICogdGhpcy5jdHhTdGF0cy5jYW52YXMud2lkdGgsIHRoaXMuY3R4U3RhdHMuY2FudmFzLmhlaWdodCAvIG51bWJlck9mc2FtcGxlc0RyYXduICogaSwgMSwgMCwgMiAqIE1hdGguUEkpOwogICAgICAgICAgdGhpcy5jdHhTdGF0cy5maWxsKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIC8vcmdiID0gIiNmZjAwMDAiOwogICAgICAgICAgcmdiID0gIiMiICsgTWF0aC5yb3VuZCgoMSAtIHRoaXMuc2FtcGxlc1tpXS5yZXdhcmQpICogMjU1KS50b1N0cmluZygxNikgKyAiMDAwMCI7CiAgICAgICAgICB0aGlzLmN0eFN0YXRzLmZpbGxTdHlsZSA9IHJnYjsKICAgICAgICAgIHRoaXMuY3R4U3RhdHMuYXJjKHRoaXMuc2FtcGxlc1tpXS5hY3Rpb24gKiB0aGlzLmN0eFN0YXRzLmNhbnZhcy53aWR0aCwgdGhpcy5jdHhTdGF0cy5jYW52YXMuaGVpZ2h0IC8gbnVtYmVyT2ZzYW1wbGVzRHJhd24gKiBpLCAxLCAwLCAyICogTWF0aC5QSSk7CiAgICAgICAgICB0aGlzLmN0eFN0YXRzLmZpbGwoKTsKICAgICAgICB9CiAgICAgIH0gLy90aGlzLmN0eFN0YXRzLnN0cm9rZSgpOwoKICAgIH0sCiAgICBtb3ZlQ2FyOiBmdW5jdGlvbiBtb3ZlQ2FyKCkgewogICAgICB0aGlzLnRlc3RpbmdEYXRhSW5wdXQgPSBfdG9Db25zdW1hYmxlQXJyYXkodGhpcy52aWV3UGl4ZWxzKTsgLy90aGlzLnRlc3RpbmdEYXRhSW5wdXQucHVzaCgxLjApOwoKICAgICAgdmFyIHJlZiA9IHRoaXM7CiAgICAgIHRoaXMuZ2V0U3RlZXJpbmcoKS50aGVuKGZ1bmN0aW9uICh2YWx1ZSkgewogICAgICAgIC8vY29uc29sZS5sb2coInByZWRpY3RlZCBzdGVlcmluZzogIit2YWx1ZSk7CiAgICAgICAgdmFsdWUgPSBNYXRoLm1pbih2YWx1ZSwgMSk7CiAgICAgICAgdmFsdWUgPSBNYXRoLm1heCh2YWx1ZSwgMCk7IC8vY29uc29sZS5sb2coInByZWRpY3RlZCBzdGVlcmluZzogIit2YWx1ZSk7CgogICAgICAgIHJlZi5jYXIuc3RlZXJpbmdQcmVkaWN0ZWQgPSB2YWx1ZTsKICAgICAgICB2YXIgcmFuZG9taXNhdGlvbiA9IDA7CgogICAgICAgIGlmIChyZWYuc2FtcGxlc1swXSkgewogICAgICAgICAgaWYgKHJlZi5zYW1wbGVzWzBdLnJld2FyZCA8IDAuNSkgewogICAgICAgICAgICByYW5kb21pc2F0aW9uID0gTWF0aC5taW4oMC43NSwgcmVmLmJhZFJld2FyZHMgLyByZWYuc2FtcGxlcy5sZW5ndGggKiByZWYuYmFkUmV3YXJkc0luQVJvdyk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByYW5kb21pc2F0aW9uID0gMC4wNTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmFuZG9taXNhdGlvbiA9IDAuNzU7CiAgICAgICAgfSAvL2NvbnNvbGUubG9nKCJyYW5kb21pc2F0aW9uOiAiK3JhbmRvbWlzYXRpb24pOwoKCiAgICAgICAgdmFyIHJhbmRvbSA9IE1hdGgucmFuZG9tKCk7CiAgICAgICAgdmFyIHJhbmRvbWlzZWRWYWx1ZSA9IHZhbHVlIC0gcmFuZG9taXNhdGlvbiAqIDEgKyByYW5kb20gKiByYW5kb21pc2F0aW9uICogMjsKICAgICAgICByYW5kb21pc2VkVmFsdWUgPSBNYXRoLm1pbihyYW5kb21pc2VkVmFsdWUsIDEpOwogICAgICAgIHJhbmRvbWlzZWRWYWx1ZSA9IE1hdGgubWF4KHJhbmRvbWlzZWRWYWx1ZSwgMCk7CiAgICAgICAgcmVmLmNhci5zdGVlcmluZyA9IHJhbmRvbWlzZWRWYWx1ZTsgLy9jb25zb2xlLmxvZygibmV3IHN0ZWVyaW5nOiAiK3JhbmRvbWlzZWRWYWx1ZSk7CgogICAgICAgIGlmIChyZWYuY2FyLnN0ZWVyaW5nIDwgMC41KSB7CiAgICAgICAgICAvLyBsZWZ0CiAgICAgICAgICB2YXIgc3RlZXJpbmdTdHJlbmd0aCA9ICgwLjUgLSByZWYuY2FyLnN0ZWVyaW5nKSAqIDI7CiAgICAgICAgICByZWYuY2FyLmFuZ2xlIC09IHJlZi5jYXIuc3RlZXJpbmdTcGVlZCAqIHN0ZWVyaW5nU3RyZW5ndGg7CiAgICAgICAgfSBlbHNlIGlmIChyZWYuY2FyLnN0ZWVyaW5nID4gMC41KSB7CiAgICAgICAgICAvLyByaWdodAogICAgICAgICAgdmFyIF9zdGVlcmluZ1N0cmVuZ3RoID0gKHJlZi5jYXIuc3RlZXJpbmcgLSAwLjUpICogMjsKCiAgICAgICAgICByZWYuY2FyLmFuZ2xlICs9IHJlZi5jYXIuc3RlZXJpbmdTcGVlZCAqIF9zdGVlcmluZ1N0cmVuZ3RoOwogICAgICAgIH0KCiAgICAgICAgcmVmLmNhci54ICs9IE1hdGguc2luKHJlZi5jYXIuYW5nbGUpICogcmVmLmNhci5zcGVlZDsKICAgICAgICByZWYuY2FyLnkgLT0gTWF0aC5jb3MocmVmLmNhci5hbmdsZSkgKiByZWYuY2FyLnNwZWVkOwogICAgICAgIHJlZi5jaGVja0NhckNvbGxpc2lvbigpOwogICAgICB9KTsKICAgIH0sCiAgICBnZXRWaWV3OiBmdW5jdGlvbiBnZXRWaWV3KCkgewogICAgICAvLyB2aWV3CiAgICAgIHRoaXMuY2FyLnZpZXdYID0gdGhpcy5jYXIueCArIE1hdGguc2luKHRoaXMuY2FyLmFuZ2xlKSAqICh0aGlzLmNhci5sZW5ndGggKiAwICsgdGhpcy52aWV3U2l6ZSAvIDIpOwogICAgICB0aGlzLmNhci52aWV3WSA9IHRoaXMuY2FyLnkgLSBNYXRoLmNvcyh0aGlzLmNhci5hbmdsZSkgKiAodGhpcy5jYXIubGVuZ3RoICogMCArIHRoaXMudmlld1NpemUgLyAyKTsgLy8gZ2V0IHZpZXcgaW1hZ2UKCiAgICAgIHRoaXMuc25hcHNob3RXaGVyZVZpZXdJcyA9IHRoaXMuY3R4LmdldEltYWdlRGF0YSh0aGlzLmNhci52aWV3WCAtIHRoaXMuY3R4Vmlld1NuYXBzaG90LmNhbnZhcy53aWR0aCAvIDIsIHRoaXMuY2FyLnZpZXdZIC0gdGhpcy5jdHhWaWV3U25hcHNob3QuY2FudmFzLmhlaWdodCAvIDIsIHRoaXMuY3R4Vmlld1NuYXBzaG90LmNhbnZhcy53aWR0aCwgdGhpcy5jdHhWaWV3U25hcHNob3QuY2FudmFzLmhlaWdodCk7IC8vIHJlYWQgcGl4ZWxzCgogICAgICB2YXIgdmlld1NuYXBzaG90UGl4ZWxzID0gW107CgogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuc25hcHNob3RXaGVyZVZpZXdJcy5kYXRhLmxlbmd0aDsgaSArPSA0KSB7CiAgICAgICAgdmFyIHIgPSB0aGlzLnNuYXBzaG90V2hlcmVWaWV3SXMuZGF0YVtpXTsKICAgICAgICB2YXIgZyA9IHRoaXMuc25hcHNob3RXaGVyZVZpZXdJcy5kYXRhW2kgKyAxXTsKICAgICAgICB2YXIgYiA9IHRoaXMuc25hcHNob3RXaGVyZVZpZXdJcy5kYXRhW2kgKyAyXTsKICAgICAgICB2aWV3U25hcHNob3RQaXhlbHMucHVzaChbciwgZywgYl0pOwogICAgICB9IC8vIGRyYXcgcm90YXRlZCBpbWFnZQoKCiAgICAgIHRoaXMuY3R4Vmlld1NuYXBzaG90LnNhdmUoKTsKICAgICAgdGhpcy5jdHhWaWV3U25hcHNob3QuY2xlYXJSZWN0KDAsIDAsIHRoaXMuY3R4Vmlld1NuYXBzaG90LmNhbnZhcy53aWR0aCwgdGhpcy5jdHhWaWV3U25hcHNob3QuY2FudmFzLmhlaWdodCk7CiAgICAgIHRoaXMuY3R4Vmlld1NuYXBzaG90LnRyYW5zbGF0ZSh0aGlzLmN0eFZpZXdTbmFwc2hvdC5jYW52YXMud2lkdGggLyAyLCB0aGlzLmN0eFZpZXdTbmFwc2hvdC5jYW52YXMuaGVpZ2h0IC8gMik7CiAgICAgIHRoaXMuY3R4Vmlld1NuYXBzaG90LnJvdGF0ZSgtdGhpcy5jYXIuYW5nbGUpOwogICAgICB0aGlzLmN0eFZpZXdTbmFwc2hvdC50cmFuc2xhdGUoLXRoaXMuY3R4Vmlld1NuYXBzaG90LmNhbnZhcy53aWR0aCAvIDIsIC10aGlzLmN0eFZpZXdTbmFwc2hvdC5jYW52YXMuaGVpZ2h0IC8gMik7CgogICAgICBmb3IgKHZhciB5ID0gMDsgeSA8IHRoaXMuY3R4Vmlld1NuYXBzaG90LmNhbnZhcy5oZWlnaHQ7IHkrKykgewogICAgICAgIGZvciAodmFyIHggPSAwOyB4IDwgdGhpcy5jdHhWaWV3U25hcHNob3QuY2FudmFzLndpZHRoOyB4KyspIHsKICAgICAgICAgIHZhciBwaXhlbEluZGV4ID0geSAqIHRoaXMuY3R4Vmlld1NuYXBzaG90LmNhbnZhcy53aWR0aCArIHg7CiAgICAgICAgICB2YXIgY29sb3IgPSB0aGlzLnJnYlRvSGV4KHZpZXdTbmFwc2hvdFBpeGVsc1twaXhlbEluZGV4XVswXSwgdmlld1NuYXBzaG90UGl4ZWxzW3BpeGVsSW5kZXhdWzFdLCB2aWV3U25hcHNob3RQaXhlbHNbcGl4ZWxJbmRleF1bMl0pOwogICAgICAgICAgdGhpcy5jdHhWaWV3U25hcHNob3QuZmlsbFN0eWxlID0gY29sb3I7CiAgICAgICAgICB0aGlzLmN0eFZpZXdTbmFwc2hvdC5maWxsUmVjdCh4LCB5LCAxLjUsIDEuNSk7CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLmN0eFZpZXdTbmFwc2hvdC5yZXN0b3JlKCk7IC8vIGdldCB2aWV3IGltYWdlCgogICAgICB0aGlzLmltZ1doZXJlVmlld0lzID0gdGhpcy5jdHhWaWV3U25hcHNob3QuZ2V0SW1hZ2VEYXRhKHRoaXMuY3R4Vmlld1NuYXBzaG90LmNhbnZhcy53aWR0aCAvIDIgLSB0aGlzLmN0eFZpZXcuY2FudmFzLndpZHRoIC8gMiwgdGhpcy5jdHhWaWV3U25hcHNob3QuY2FudmFzLmhlaWdodCAvIDIgLSB0aGlzLmN0eFZpZXcuY2FudmFzLmhlaWdodCAvIDIsIHRoaXMuY3R4Vmlldy5jYW52YXMud2lkdGgsIHRoaXMuY3R4Vmlldy5jYW52YXMuaGVpZ2h0KTsKICAgICAgdGhpcy5jdHhWaWV3LnB1dEltYWdlRGF0YSh0aGlzLmltZ1doZXJlVmlld0lzLCAwLCAwKTsgLy8gcmVhZCBwaXhlbHMKCiAgICAgIHZhciB2aWV3UGl4ZWxzID0gW107CgogICAgICBmb3IgKHZhciBfaTMgPSAwOyBfaTMgPCB0aGlzLmltZ1doZXJlVmlld0lzLmRhdGEubGVuZ3RoOyBfaTMgKz0gNCkgewogICAgICAgIHZhciBfciA9IHRoaXMuaW1nV2hlcmVWaWV3SXMuZGF0YVtfaTNdOwogICAgICAgIHZhciBfZyA9IHRoaXMuaW1nV2hlcmVWaWV3SXMuZGF0YVtfaTMgKyAxXTsKICAgICAgICB2YXIgX2IgPSB0aGlzLmltZ1doZXJlVmlld0lzLmRhdGFbX2kzICsgMl07CiAgICAgICAgdmlld1BpeGVscy5wdXNoKFtfciwgX2csIF9iXSk7CiAgICAgIH0KCiAgICAgIHZhciB2aWV3UGl4ZWxzUmVkdWNlZCA9IHZpZXdQaXhlbHM7CgogICAgICBmb3IgKHZhciBfaTQgPSAwOyBfaTQgPCB0aGlzLnZpZXdSZWR1Y3Rpb247IF9pNCsrKSB7CiAgICAgICAgdmlld1BpeGVsc1JlZHVjZWQgPSB0aGlzLnJlZHVjZVBpeGVscyh2aWV3UGl4ZWxzUmVkdWNlZCwgTWF0aC5zcXJ0KHZpZXdQaXhlbHNSZWR1Y2VkLmxlbmd0aCkpOwogICAgICB9IC8vIGRyYXcgcmVkdWNlZCB2aWV3CgoKICAgICAgZm9yICh2YXIgX3kgPSAwOyBfeSA8IHRoaXMuY3R4Vmlld1JlZHVjZWQuY2FudmFzLmhlaWdodDsgX3krKykgewogICAgICAgIGZvciAodmFyIF94ID0gMDsgX3ggPCB0aGlzLmN0eFZpZXdSZWR1Y2VkLmNhbnZhcy53aWR0aDsgX3grKykgewogICAgICAgICAgdmFyIF9waXhlbEluZGV4ID0gX3kgKiB0aGlzLmN0eFZpZXdSZWR1Y2VkLmNhbnZhcy53aWR0aCArIF94OwoKICAgICAgICAgIHZhciBfY29sb3IgPSB0aGlzLnJnYlRvSGV4KHZpZXdQaXhlbHNSZWR1Y2VkW19waXhlbEluZGV4XVswXSwgdmlld1BpeGVsc1JlZHVjZWRbX3BpeGVsSW5kZXhdWzFdLCB2aWV3UGl4ZWxzUmVkdWNlZFtfcGl4ZWxJbmRleF1bMl0pOwoKICAgICAgICAgIHRoaXMuY3R4Vmlld1JlZHVjZWQuZmlsbFN0eWxlID0gX2NvbG9yOwogICAgICAgICAgdGhpcy5jdHhWaWV3UmVkdWNlZC5maWxsUmVjdChfeCwgX3ksIDEuNSwgMS41KTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHZhciBwcmV2aW91c1RvdGFsQnJpZ2h0bmVzczsgLy8gY3JlYXRlIHNhbXBsZQoKICAgICAgaWYgKHRoaXMudmlld1BpeGVscykgewogICAgICAgIC8vIGhhcyBwcmV2aW91cyBzdGF0ZQogICAgICAgIHRoaXMuc2FtcGxlcy51bnNoaWZ0KHsKICAgICAgICAgIHN0YXRlOiB0aGlzLnZpZXdQaXhlbHMsCiAgICAgICAgICBhY3Rpb246IHRoaXMuY2FyLnN0ZWVyaW5nLAogICAgICAgICAgYWN0aW9uUHJlZGljdGVkOiB0aGlzLmNhci5zdGVlcmluZ1ByZWRpY3RlZAogICAgICAgIH0pOyAvL3RoaXMuc2FtcGxlcyA9IHRoaXMuc2FtcGxlcy5zbGljZSgwLHRoaXMuc2FtcGxlc01heExlbmd0aCk7CgogICAgICAgIHByZXZpb3VzVG90YWxCcmlnaHRuZXNzID0gdGhpcy50b3RhbEJyaWdodG5lc3M7CiAgICAgIH0gLy8gc2F2ZSBuZXcgdmlldyBwaXhlbHMKCgogICAgICB0aGlzLnZpZXdQaXhlbHMgPSBbXTsKICAgICAgdGhpcy50b3RhbEJyaWdodG5lc3MgPSAwOwoKICAgICAgZm9yICh2YXIgX2k1ID0gMDsgX2k1IDwgdmlld1BpeGVsc1JlZHVjZWQubGVuZ3RoOyBfaTUrKykgewogICAgICAgIHZhciBicmlnaHRuZXNzID0gKHZpZXdQaXhlbHNSZWR1Y2VkW19pNV1bMF0gKyB2aWV3UGl4ZWxzUmVkdWNlZFtfaTVdWzFdICsgdmlld1BpeGVsc1JlZHVjZWRbX2k1XVsyXSkgLyA3NjU7CiAgICAgICAgdGhpcy52aWV3UGl4ZWxzLnB1c2goYnJpZ2h0bmVzcyk7CiAgICAgICAgdGhpcy50b3RhbEJyaWdodG5lc3MgKz0gYnJpZ2h0bmVzczsKICAgICAgfQoKICAgICAgdGhpcy50b3RhbEJyaWdodG5lc3MgPSB0aGlzLnRvdGFsQnJpZ2h0bmVzcyAvIHRoaXMudmlld1BpeGVscy5sZW5ndGg7CgogICAgICBpZiAodGhpcy5zYW1wbGVzLmxlbmd0aCkgewogICAgICAgIHZhciBicmlnaHRuZXNzQ2hhbmdlID0gdGhpcy50b3RhbEJyaWdodG5lc3MgLSBwcmV2aW91c1RvdGFsQnJpZ2h0bmVzczsKICAgICAgICBjb25zb2xlLmxvZygiLS0tIik7IC8vY29uc29sZS5sb2coICJ0b3RhbEJyaWdodG5lc3M6ICIrIHRoaXMudG90YWxCcmlnaHRuZXNzICk7CiAgICAgICAgLy9jb25zb2xlLmxvZyggInByZXZpb3VzVG90YWxCcmlnaHRuZXNzOiAiKyBwcmV2aW91c1RvdGFsQnJpZ2h0bmVzcyApOwogICAgICAgIC8vY29uc29sZS5sb2coICJicmlnaHRuZXNzQ2hhbmdlOiAiKyBicmlnaHRuZXNzQ2hhbmdlICk7CgogICAgICAgIHZhciByZXdhcmQ7CgogICAgICAgIGlmIChicmlnaHRuZXNzQ2hhbmdlID49IDApIHsKICAgICAgICAgIC8vIGJldHRlcgoKICAgICAgICAgIC8qCiAgICAgICAgICBpZiggdGhpcy50b3RhbEJyaWdodG5lc3MgPiAwLjUgKSB7CiAgICAgICAgICAgIC8vIG5vdCBzbyBiYWQgc2l0dWF0aW9uCiAgICAgICAgICAgIHJld2FyZCA9IDE7CiAgICAgICAgICB9CiAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgLy8gYmFkIHNpdHVhdGlvbgogICAgICAgICAgICByZXdhcmQgPSAwLjc1ICsgTWF0aC5taW4oIDAuMjUsIGJyaWdodG5lc3NDaGFuZ2UqMTAgKiB0aGlzLnRvdGFsQnJpZ2h0bmVzcyApOwogICAgICAgICAgfQogICAgICAgICAgKi8KICAgICAgICAgIHJld2FyZCA9IDE7IC8vY29uc29sZS5sb2cocmV3YXJkKyI6IGJldHRlciIpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAvKgogICAgICAgICAgLy8gd29yc2UKICAgICAgICAgIGlmKCB0aGlzLnRvdGFsQnJpZ2h0bmVzcyA8IDAuNSApIHsKICAgICAgICAgICAgLy8gYmFkIHNpdHVhdGlvbgogICAgICAgICAgICByZXdhcmQgPSAwOwogICAgICAgICAgfQogICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIC8vIGJhZCBzaXR1YXRpb24KICAgICAgICAgICAgcmV3YXJkID0gTWF0aC5taW4oIDAuMjUsIE1hdGguYWJzKGJyaWdodG5lc3NDaGFuZ2UpKjEwICogdGhpcy50b3RhbEJyaWdodG5lc3MgKTsKICAgICAgICAgIH0KICAgICAgICAgICovCiAgICAgICAgICByZXdhcmQgPSAwOyAvL2NvbnNvbGUubG9nKHJld2FyZCsiOiB3b3JzZSIpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5zYW1wbGVzWzBdLnJld2FyZCA9IHJld2FyZDsgLy8gY2FsY3VsYXRlIHRvdGFsIGFjY3VhcmN5CgogICAgICAgIGlmIChyZXdhcmQgPCAwLjUpIHsKICAgICAgICAgIHRoaXMuYmFkUmV3YXJkcysrOwogICAgICAgICAgdGhpcy5iYWRSZXdhcmRzSW5BUm93Kys7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuYmFkUmV3YXJkc0luQVJvdyA9IDA7CiAgICAgICAgfSAvLyB0cmltIHNhbXBsZXM6CgoKICAgICAgICBpZiAodGhpcy5zYW1wbGVzLmxlbmd0aCA9PT0gdGhpcy5zYW1wbGVzTWF4TGVuZ3RoKSB7CiAgICAgICAgICAvL2NvbnNvbGUubG9nKCJtYXggbGVuZ3RoIHJlYWNoZWQ6ICIrdGhpcy5zYW1wbGVzLmxlbmd0aCk7CiAgICAgICAgICBpZiAodGhpcy5zYW1wbGVzW3RoaXMuc2FtcGxlcy5sZW5ndGggLSAxXS5yZXdhcmQgPCAwLjUpIHsKICAgICAgICAgICAgLy9jb25zb2xlLmxvZygibGFzdCBpcyBiYWRSZXdhcmQiKTsKICAgICAgICAgICAgdGhpcy5iYWRSZXdhcmRzLS07CiAgICAgICAgICB9IC8vY29uc29sZS5sb2coInJlbW92ZSIpOwoKCiAgICAgICAgICB0aGlzLnNhbXBsZXMgPSB0aGlzLnNhbXBsZXMuc2xpY2UoMCwgdGhpcy5zYW1wbGVzTWF4TGVuZ3RoIC0gMSk7IC8vY29uc29sZS5sb2coIm5ldyBsZW5ndGg6ICIgK3RoaXMuc2FtcGxlcy5sZW5ndGgpOwogICAgICAgIH0KCiAgICAgICAgY29uc29sZS5sb2coImdvb2Qgc2FtcGxlczogIiArICh0aGlzLnNhbXBsZXMubGVuZ3RoIC0gdGhpcy5iYWRSZXdhcmRzKSArICIgb2YgIiArIHRoaXMuc2FtcGxlcy5sZW5ndGgpOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIGZpcnN0IGN5Y2xlCiAgICAgICAgdGhpcy5iYWRSZXdhcmRzID0gMDsKICAgICAgICB0aGlzLmJhZFJld2FyZHNJbkFSb3cgPSAwOwogICAgICB9CiAgICB9LAogICAgY2hlY2tDYXJDb2xsaXNpb246IGZ1bmN0aW9uIGNoZWNrQ2FyQ29sbGlzaW9uKCkgewogICAgICAvLyBnZXQgY2FyIGltYWdlCiAgICAgIHRoaXMuc25hcHNob3RXaGVyZUNhcklzID0gdGhpcy5jdHguZ2V0SW1hZ2VEYXRhKHRoaXMuY2FyLnggLSB0aGlzLmN0eENhclNuYXBzaG90LmNhbnZhcy53aWR0aCAvIDIsIHRoaXMuY2FyLnkgLSB0aGlzLmN0eENhclNuYXBzaG90LmNhbnZhcy5oZWlnaHQgLyAyLCB0aGlzLmN0eENhclNuYXBzaG90LmNhbnZhcy53aWR0aCwgdGhpcy5jdHhDYXJTbmFwc2hvdC5jYW52YXMuaGVpZ2h0KTsgLy8gcmVhZCBwaXhlbHMKCiAgICAgIHZhciBjYXJTbmFwc2hvdFBpeGVscyA9IFtdOwoKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnNuYXBzaG90V2hlcmVDYXJJcy5kYXRhLmxlbmd0aDsgaSArPSA0KSB7CiAgICAgICAgdmFyIHIgPSB0aGlzLnNuYXBzaG90V2hlcmVDYXJJcy5kYXRhW2ldOwogICAgICAgIHZhciBnID0gdGhpcy5zbmFwc2hvdFdoZXJlQ2FySXMuZGF0YVtpICsgMV07CiAgICAgICAgdmFyIGIgPSB0aGlzLnNuYXBzaG90V2hlcmVDYXJJcy5kYXRhW2kgKyAyXTsKICAgICAgICBjYXJTbmFwc2hvdFBpeGVscy5wdXNoKFtyLCBnLCBiXSk7CiAgICAgIH0gLy8gZHJhdyByb3RhdGVkIGltYWdlCgoKICAgICAgdGhpcy5jdHhDYXJTbmFwc2hvdC5zYXZlKCk7CiAgICAgIHRoaXMuY3R4Q2FyU25hcHNob3QuY2xlYXJSZWN0KDAsIDAsIHRoaXMuY3R4Q2FyU25hcHNob3QuY2FudmFzLndpZHRoLCB0aGlzLmN0eENhclNuYXBzaG90LmNhbnZhcy5oZWlnaHQpOwogICAgICB0aGlzLmN0eENhclNuYXBzaG90LnRyYW5zbGF0ZSh0aGlzLmN0eENhclNuYXBzaG90LmNhbnZhcy53aWR0aCAvIDIsIHRoaXMuY3R4Q2FyU25hcHNob3QuY2FudmFzLmhlaWdodCAvIDIpOwogICAgICB0aGlzLmN0eENhclNuYXBzaG90LnJvdGF0ZSgtdGhpcy5jYXIuYW5nbGUpOwogICAgICB0aGlzLmN0eENhclNuYXBzaG90LnRyYW5zbGF0ZSgtdGhpcy5jdHhDYXJTbmFwc2hvdC5jYW52YXMud2lkdGggLyAyLCAtdGhpcy5jdHhDYXJTbmFwc2hvdC5jYW52YXMuaGVpZ2h0IC8gMik7CgogICAgICBmb3IgKHZhciB5ID0gMDsgeSA8IHRoaXMuY3R4Q2FyU25hcHNob3QuY2FudmFzLmhlaWdodDsgeSsrKSB7CiAgICAgICAgZm9yICh2YXIgeCA9IDA7IHggPCB0aGlzLmN0eENhclNuYXBzaG90LmNhbnZhcy53aWR0aDsgeCsrKSB7CiAgICAgICAgICB2YXIgcGl4ZWxJbmRleCA9IHkgKiB0aGlzLmN0eENhclNuYXBzaG90LmNhbnZhcy53aWR0aCArIHg7CiAgICAgICAgICB2YXIgY29sb3IgPSB0aGlzLnJnYlRvSGV4KGNhclNuYXBzaG90UGl4ZWxzW3BpeGVsSW5kZXhdWzBdLCBjYXJTbmFwc2hvdFBpeGVsc1twaXhlbEluZGV4XVsxXSwgY2FyU25hcHNob3RQaXhlbHNbcGl4ZWxJbmRleF1bMl0pOwogICAgICAgICAgdGhpcy5jdHhDYXJTbmFwc2hvdC5maWxsU3R5bGUgPSBjb2xvcjsKICAgICAgICAgIHRoaXMuY3R4Q2FyU25hcHNob3QuZmlsbFJlY3QoeCwgeSwgMS41LCAxLjUpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy5jdHhDYXJTbmFwc2hvdC5yZXN0b3JlKCk7IC8vIGdldCBjYXIgaW1hZ2UKCiAgICAgIHRoaXMuaW1nV2hlcmVDYXJJcyA9IHRoaXMuY3R4Q2FyU25hcHNob3QuZ2V0SW1hZ2VEYXRhKHRoaXMuY3R4Q2FyU25hcHNob3QuY2FudmFzLndpZHRoIC8gMiAtIHRoaXMuY3R4Q2FyLmNhbnZhcy53aWR0aCAvIDIsIHRoaXMuY3R4Q2FyU25hcHNob3QuY2FudmFzLmhlaWdodCAvIDIgLSB0aGlzLmN0eENhci5jYW52YXMuaGVpZ2h0IC8gMiwgdGhpcy5jdHhDYXIuY2FudmFzLndpZHRoLCB0aGlzLmN0eENhci5jYW52YXMuaGVpZ2h0KTsKICAgICAgdGhpcy5jdHhDYXIucHV0SW1hZ2VEYXRhKHRoaXMuaW1nV2hlcmVDYXJJcywgMCwgMCk7CiAgICAgIHRoaXMuZHJhd0NhckFuZFZpZXdTcXVhcmUoKTsgLy8gcmVhZCBwaXhlbHMKCiAgICAgIHZhciB0b3RhbFIgPSAwOwogICAgICB2YXIgdG90YWxHID0gMDsKICAgICAgdmFyIHRvdGFsQiA9IDA7CgogICAgICBmb3IgKHZhciBfaTYgPSAwOyBfaTYgPCB0aGlzLmltZ1doZXJlQ2FySXMuZGF0YS5sZW5ndGg7IF9pNiArPSA0KSB7CiAgICAgICAgdG90YWxSICs9IHRoaXMuaW1nV2hlcmVDYXJJcy5kYXRhW19pNl07CiAgICAgICAgdG90YWxHICs9IHRoaXMuaW1nV2hlcmVDYXJJcy5kYXRhW19pNiArIDFdOwogICAgICAgIHRvdGFsQiArPSB0aGlzLmltZ1doZXJlQ2FySXMuZGF0YVtfaTYgKyAyXTsKICAgICAgfQoKICAgICAgdG90YWxSID0gTWF0aC5yb3VuZCh0b3RhbFIgLyAodGhpcy5pbWdXaGVyZUNhcklzLmRhdGEubGVuZ3RoIC8gNCkpOwogICAgICB0b3RhbEcgPSBNYXRoLnJvdW5kKHRvdGFsRyAvICh0aGlzLmltZ1doZXJlQ2FySXMuZGF0YS5sZW5ndGggLyA0KSk7CiAgICAgIHRvdGFsQiA9IE1hdGgucm91bmQodG90YWxCIC8gKHRoaXMuaW1nV2hlcmVDYXJJcy5kYXRhLmxlbmd0aCAvIDQpKTsKCiAgICAgIGlmICh0b3RhbFIgKyB0b3RhbEcgKyB0b3RhbEIgPCA3NjApIHsKICAgICAgICBjb25zb2xlLmxvZygiY29sbGlzaW9uISIpOwogICAgICAgIHRoaXMudmlld1BpeGVscyA9IG51bGw7CiAgICAgICAgdGhpcy5jYXIuc3RlZXJpbmcgPSB1bmRlZmluZWQ7CiAgICAgICAgdGhpcy5yZXNldENhcigpOwoKICAgICAgICBpZiAodGhpcy5oaWdoc2NvcmVzLmxlbmd0aCA8IHRoaXMuaGlnaHNjb3Jlc01heExlbmd0aCB8fCB0aGlzLnNjb3JlID4gdGhpcy5oaWdoc2NvcmVzW3RoaXMuaGlnaHNjb3Jlc01heExlbmd0aCAtIDFdLnNjb3JlKSB7CiAgICAgICAgICBjb25zb2xlLmxvZygibmV3IGhpZ2hzY29yZSIpOwogICAgICAgICAgdGhpcy5oaWdoc2NvcmVzLnB1c2goewogICAgICAgICAgICBzY29yZTogdGhpcy5zY29yZSwKICAgICAgICAgICAgc2FtcGxlczogX3RvQ29uc3VtYWJsZUFycmF5KHRoaXMuc2FtcGxlcyksCiAgICAgICAgICAgIG1vZGVsSW5kZXg6IHRoaXMubW9kZWxJbmRleAogICAgICAgICAgfSk7CiAgICAgICAgICB0aGlzLmhpZ2hzY29yZXMuc29ydChmdW5jdGlvbiAoYSwgYikgewogICAgICAgICAgICByZXR1cm4gYi5zY29yZSAtIGEuc2NvcmU7CiAgICAgICAgICB9KTsKICAgICAgICAgIHRoaXMuaGlnaHNjb3JlcyA9IHRoaXMuaGlnaHNjb3Jlcy5zbGljZSgwLCB0aGlzLmhpZ2hzY29yZXNNYXhMZW5ndGgpOwogICAgICAgIH0KCiAgICAgICAgY29uc29sZS5sb2coInRyYWluIik7CiAgICAgICAgdGhpcy50cmFpbigpOwogICAgICAgIHRoaXMuZHJhd1N0YXRzKCk7CiAgICAgICAgdGhpcy5zYW1wbGVzID0gW107CiAgICAgICAgdGhpcy5sYXN0U2NvcmUgPSB0aGlzLnNjb3JlOwogICAgICAgIHRoaXMuc2NvcmUgPSAwOyAvL3RoaXMucmVmcmVzaExvb3AgPSBudWxsOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuc2NvcmUrKzsKICAgICAgICB0aGlzLmRyYXdTdGF0cygpOwogICAgICB9CiAgICB9LAogICAgZHJhd0NhckFuZFZpZXdTcXVhcmU6IGZ1bmN0aW9uIGRyYXdDYXJBbmRWaWV3U3F1YXJlKCkgewogICAgICAvLyBkcmF3IGNhcgogICAgICB0aGlzLmN0eC5zYXZlKCk7CiAgICAgIHRoaXMuY3R4LnRyYW5zbGF0ZSh0aGlzLmNhci54LCB0aGlzLmNhci55KTsKICAgICAgdGhpcy5jdHgucm90YXRlKHRoaXMuY2FyLmFuZ2xlKTsKICAgICAgdGhpcy5jdHgudHJhbnNsYXRlKC10aGlzLmNhci54LCAtdGhpcy5jYXIueSk7CiAgICAgIHRoaXMuY3R4LmZpbGxSZWN0KHRoaXMuY2FyLnggLSB0aGlzLmNhci53aWR0aCAvIDIsIHRoaXMuY2FyLnkgLSB0aGlzLmNhci5sZW5ndGggLyAyLCB0aGlzLmNhci53aWR0aCwgdGhpcy5jYXIubGVuZ3RoKTsKICAgICAgdGhpcy5jdHgucmVzdG9yZSgpOyAvLyBkcmF3IHZpZXcgcmVjdAoKICAgICAgdGhpcy5jdHguc2F2ZSgpOwogICAgICB0aGlzLmN0eC50cmFuc2xhdGUodGhpcy5jYXIudmlld1gsIHRoaXMuY2FyLnZpZXdZKTsKICAgICAgdGhpcy5jdHgucm90YXRlKHRoaXMuY2FyLmFuZ2xlKTsKICAgICAgdGhpcy5jdHgudHJhbnNsYXRlKC10aGlzLmNhci52aWV3WCwgLXRoaXMuY2FyLnZpZXdZKTsKICAgICAgdGhpcy5jdHguc3Ryb2tlU3R5bGUgPSAiI2ZmMDAwMCI7CiAgICAgIHRoaXMuY3R4LmJlZ2luUGF0aCgpOwogICAgICB0aGlzLmN0eC5yZWN0KHRoaXMuY2FyLnZpZXdYIC0gdGhpcy5jdHhWaWV3LmNhbnZhcy53aWR0aCAvIDIsIHRoaXMuY2FyLnZpZXdZIC0gdGhpcy5jdHhWaWV3LmNhbnZhcy5oZWlnaHQgLyAyLCB0aGlzLmN0eFZpZXcuY2FudmFzLndpZHRoLCB0aGlzLmN0eFZpZXcuY2FudmFzLmhlaWdodCk7CiAgICAgIHRoaXMuY3R4LnN0cm9rZSgpOwogICAgICB0aGlzLmN0eC5yZXN0b3JlKCk7CiAgICB9LAogICAgY29tcG9uZW50VG9IZXg6IGZ1bmN0aW9uIGNvbXBvbmVudFRvSGV4KGMpIHsKICAgICAgdmFyIGhleCA9IGMudG9TdHJpbmcoMTYpOwogICAgICByZXR1cm4gaGV4Lmxlbmd0aCA9PSAxID8gIjAiICsgaGV4IDogaGV4OwogICAgfSwKICAgIHJnYlRvSGV4OiBmdW5jdGlvbiByZ2JUb0hleChyLCBnLCBiKSB7CiAgICAgIHJldHVybiAiIyIgKyB0aGlzLmNvbXBvbmVudFRvSGV4KHIpICsgdGhpcy5jb21wb25lbnRUb0hleChnKSArIHRoaXMuY29tcG9uZW50VG9IZXgoYik7CiAgICB9LAogICAgcmVkdWNlUGl4ZWxzOiBmdW5jdGlvbiByZWR1Y2VQaXhlbHMocGl4ZWxzLCBzaXplKSB7CiAgICAgIC8vIHJlZHVjZSByZXNvbHV0aW9uCiAgICAgIHZhciBwaXhlbHNSZWR1Y2VkID0gW107CgogICAgICBmb3IgKHZhciB5ID0gMDsgeSA8IHNpemU7IHkgKz0gMikgewogICAgICAgIGZvciAodmFyIHggPSAwOyB4IDwgc2l6ZTsgeCArPSAyKSB7CiAgICAgICAgICB2YXIgcGl4ZWxJbmRleGVzID0gW3kgKiBzaXplICsgeCwgeSAqIHNpemUgKyB4ICsgMSwgKHkgKyAxKSAqIHNpemUgKyB4LCAoeSArIDEpICogc2l6ZSArIHggKyAxXTsKICAgICAgICAgIHZhciB0b3RhbFIgPSAwOwogICAgICAgICAgdmFyIHRvdGFsRyA9IDA7CiAgICAgICAgICB2YXIgdG90YWxCID0gMDsKCiAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHBpeGVsSW5kZXhlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICB0b3RhbFIgKz0gcGl4ZWxzW3BpeGVsSW5kZXhlc1tpXV1bMF07CiAgICAgICAgICAgIHRvdGFsRyArPSBwaXhlbHNbcGl4ZWxJbmRleGVzW2ldXVsxXTsKICAgICAgICAgICAgdG90YWxCICs9IHBpeGVsc1twaXhlbEluZGV4ZXNbaV1dWzJdOwogICAgICAgICAgfQoKICAgICAgICAgIHRvdGFsUiA9IE1hdGgucm91bmQodG90YWxSIC8gcGl4ZWxJbmRleGVzLmxlbmd0aCk7CiAgICAgICAgICB0b3RhbEcgPSBNYXRoLnJvdW5kKHRvdGFsRyAvIHBpeGVsSW5kZXhlcy5sZW5ndGgpOwogICAgICAgICAgdG90YWxCID0gTWF0aC5yb3VuZCh0b3RhbEIgLyBwaXhlbEluZGV4ZXMubGVuZ3RoKTsKICAgICAgICAgIHBpeGVsc1JlZHVjZWQucHVzaChbdG90YWxSLCB0b3RhbEcsIHRvdGFsQl0pOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIHBpeGVsc1JlZHVjZWQ7CiAgICB9LAogICAgZHJhd1dvcmxkOiBmdW5jdGlvbiBkcmF3V29ybGQoKSB7CiAgICAgIHRoaXMuY3R4LmNsZWFyUmVjdCgwLCAwLCB0aGlzLmN0eC5jYW52YXMud2lkdGgsIHRoaXMuY3R4LmNhbnZhcy5oZWlnaHQpOwogICAgICB0aGlzLmN0eC5kcmF3SW1hZ2UodGhpcy5pbWdXb3JsZCwgMCwgMCwgdGhpcy5jdHguY2FudmFzLndpZHRoLCB0aGlzLmN0eC5jYW52YXMuaGVpZ2h0KTsKICAgIH0sCiAgICByZXNldENhcjogZnVuY3Rpb24gcmVzZXRDYXIoKSB7CiAgICAgIGNvbnNvbGUubG9nKCJyZXNldCBjYXIiKTsKICAgICAgdGhpcy5jYXIueCA9IHRoaXMud29ybGRXaWR0aCAvIDIgKiAwLjI1OwogICAgICB0aGlzLmNhci55ID0gdGhpcy53b3JsZEhlaWdodCAvIDIgKiAxLjU7CiAgICAgIHRoaXMuY2FyLmFuZ2xlID0gMDsKICAgIH0KICAgIC8qCiAgICBrZXlEb3duKGUpIHsKICAgICAgaWYoIGUuY29kZSA9PT0gIkFycm93TGVmdCIgKSB7CiAgICAgICAgdGhpcy5jYXIuc3RlZXJpbmcgPSAwOwogICAgICB9CiAgICAgIGVsc2UgaWYoIGUuY29kZSA9PT0gIkFycm93UmlnaHQiICkgewogICAgICAgIHRoaXMuY2FyLnN0ZWVyaW5nID0gMTsKICAgICAgfQogICAgfSwKICAgIGtleVVwKGUpIHsKICAgICAgaWYoIGUuY29kZSA9PT0gIkFycm93TGVmdCIgKSB7CiAgICAgICAgdGhpcy5jYXIuc3RlZXJpbmcgPSB1bmRlZmluZWQ7CiAgICAgIH0KICAgICAgZWxzZSBpZiggZS5jb2RlID09PSAiQXJyb3dSaWdodCIgKSB7CiAgICAgICAgdGhpcy5jYXIuc3RlZXJpbmcgPSB1bmRlZmluZWQ7CiAgICAgIH0KICAgIH0KICAgICovCgogIH0KfTs="},{"version":3,"mappings":"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CA;AACA;AACA,yGAHA,CAIA;;AACA,+OALA,CAMA;;AACA;;AACA;AACA;AACA;AACA;AACAC;AACA,OAbA,CAcA;;;AACA;AACA;AACA;AACA;AACA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA,qCA5BA,CA6BA;;AACA;AACA,2DA/BA,CAgCA;;AACA;;AACA;AACA;AACA;AACA;AACArE;AACA;;AACA;;AACA;AACAsE;AACA,OA3CA,CA4CA;;;AACA;AACA;AACA;;AACA;;AACA;AACA;AACA;AACA;;AAEA,kCAtDA,CAuDA;;AACA;AACA;AACA;AACAC,gCADA;AAEAC,mCAFA;AAGAC;AAHA,WAFA,CAOA;;AACAC;AACA,OAjEA,CAmEA;;;AACA;AACA;;AACA;AACA;AACA;AACA;AACA;;AACA;;AAEA;AACA;AACAhD,2BAFA,CAGA;AACA;AACA;;AACA;;AACA;AACA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACAiD,qBAZA,CAaA;AACA,SAdA,MAeA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACAA,qBAZA,CAaA;AACA;;AACA,wCArCA,CAwCA;;AACA;AACA;AACA;AACA,SAHA,MAIA;AACA;AACA,SA/CA,CAkDA;;;AACA;AACA;AACA;AACA;AACA;AACA,WALA,CAMA;;;AACA,0EAPA,CAQA;AACA;;AACAjD;AAEA,OA/DA,MAgEA;AACA;AACA;AACA;AACA;AAEA,KA1bA;AA2bAkD,qBA3bA,+BA2bA;AACA;AACA,kOAFA,CAGA;;AACA;;AACA;AACA;AACA;AACA;AACAC;AACA,OAVA,CAWA;;;AACA;AACA;AACA;AACA;AACA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA,oCAzBA,CA0BA;;AACA;AACA;AAIA,kCAhCA,CAmCA;;AACA;AACA;AACA;;AACA;AACAC;AACAC;AACAC;AACA;;AACAF;AACAC;AACAC;;AACA;AACAtD;AAEA;AACA;AACA;;AAEA;AACAA;AAEA;AACAlB,6BADA;AAEAN,qDAFA;AAGAe;AAHA;AAKA;AAAA;AAAA;AACA;AACA;;AACAS;AACA;AAEA;AAEA;AACA;AACA,uBAzBA,CA2BA;AACA,OA5BA,MA6BA;AACA;AACA;AACA;AACA,KA3gBA;AA4gBAuD,wBA5gBA,kCA4gBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yBAPA,CASA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KA/hBA;AAgiBAC,kBAhiBA,0BAgiBAC,CAhiBA,EAgiBA;AACA;AACA;AACA,KAniBA;AAoiBAC,YApiBA,oBAoiBAC,CApiBA,EAoiBAC,CApiBA,EAoiBAC,CApiBA,EAoiBA;AACA;AACA,KAtiBA;AAuiBAC,gBAviBA,wBAuiBAC,MAviBA,EAuiBAC,IAviBA,EAuiBA;AACA;AACA;;AACA;AACA;AACA,8BACAjG,YADA,EAEAA,gBAFA,EAGA,kBAHA,EAIA,sBAJA;AAOA;AACA;AACA;;AACA;AACAqF;AACAC;AACAC;AACA;;AACAF;AACAC;AACAC;AACAW;AACA;AACA;;AACA;AACA,KAlkBA;AAmkBAC,aAnkBA,uBAmkBA;AACA;AACA;AACA,KAtkBA;AAukBAC,YAvkBA,sBAukBA;AACAnE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AA9lBA;AA1FA","names":["name","data","ctx","worldWidth","worldHeight","imgWorld","worldLoaded","fps","fpsCounter","tick","tickTime","duration","durationString","car","width","length","x","y","speed","steeringSpeed","angle","viewSize","viewReduction","viewReducedSize","viewPixels","steering","samples","samplesMaxLength","trainingSamples","trainingSamplesMaxLength","badRewards","badRewardsInARow","score","lastScore","highscores","highscoresMaxLength","highscoresMaxShown","training","trainingProgress","models","numberOfModels","modelIndex","computed","reducedViewSize","reducedSize","highscoresShown","mounted","app","methods","createModel","console","layers","units","activation","trainings","highscore","children","inputShape","loss","optimizer","metrics","train","highscoreOfModel","random","Math","highscoreIndex","mother","featureValuesTraining","labelValuesTraining","featureValueTraining","featureTensorTraining","tf","labelTensorTraining","trainModel","epochs","ref","callbacks","onEpochEnd","onTrainEnd","predict","input","getSteering","refreshLoop","window","date","enterFrame","drawStats","rgb","moveCar","value","randomisation","randomisedValue","getView","viewSnapshotPixels","viewPixelsReduced","state","action","actionPredicted","previousTotalBrightness","reward","checkCarCollision","carSnapshotPixels","totalR","totalG","totalB","drawCarAndViewSquare","componentToHex","c","rgbToHex","r","g","b","reducePixels","pixels","size","pixelsReduced","drawWorld","resetCar"],"sourceRoot":"src","sources":["App.vue"],"sourcesContent":["<template>\n  <div id=\"app\">\n    <div class=\"world\">\n      <canvas class=\"world-canvas\" ref=\"canvas\" :width=\"worldWidth\" :height=\"worldHeight\"></canvas>\n      <div class=\"training\" v-if=\"training\"><span>TRAINING<br>{{trainingProgress}}% ({{trainingSamples.length}})</span></div>\n    </div>\n    <canvas class=\"car-snapshot-canvas\" ref=\"carSnapshotCanvas\" :width=\"car.length*1.5\" :height=\"car.length*1.5\"></canvas>\n    <canvas class=\"view-snapshot-canvas\" ref=\"viewSnapshotCanvas\" :width=\"viewSize*1.5\" :height=\"viewSize*1.5\"></canvas>\n    <canvas class=\"car-canvas\" ref=\"carCanvas\" :width=\"car.width\" :height=\"car.length\"></canvas>\n    <canvas class=\"view-canvas\" ref=\"viewCanvas\" :width=\"viewSize\" :height=\"viewSize\"></canvas>\n    <canvas class=\"view-canvas-reduced\" ref=\"viewCanvasReduced\" :width=\"reducedViewSize\" :height=\"reducedViewSize\"></canvas>\n    <span class=\"fps\">{{ fps }} fps</span>\n    <div class=\"highscores\">\n      <div class=\"duration\">\n        <label>Total Duration</label>\n        {{durationString}}\n      </div>\n      <label>Highscores ({{highscores.length}})</label>\n      <ul>\n        <li v-for=\"(highscore,index) in highscoresShown\" :key=\"index\"><b>{{models[highscore.modelIndex].name}} - </b> {{highscore.score}}</li>\n        <!-- <li v-if=\"highscores.length\">last: {{highscores[highscores.length-1].score}}</li> -->\n      </ul>\n    </div>\n    <div class=\"score\">\n      <div class=\"current\">\n        <label>Current Score</label>\n        {{score}}\n      </div>\n      <div class=\"last\">\n        <label>Last Score</label>\n        {{lastScore}}\n      </div>\n    </div>\n    <div class=\"stats\">\n      <canvas class=\"stats-canvas\" ref=\"statsCanvas\" :width=\"40\" :height=\"500\"></canvas>\n    </div>\n    <div class=\"models\">\n      <label>Drivers</label>\n      <ul>\n        <li v-for=\"(model,index) in models\" :key=\"index\" :class=\"{'active':index === modelIndex}\">\n          <template v-if=\"model\">\n            {{ model.name }}\n            <span class=\"layers\">\n              [\n              <template v-for=\"(layer) in model.layers\">{{layer.units}} {{layer.activation}}, </template>\n              ]\n            </span>{{model.highscore||\"\"}} (t: {{model.trainings}})\n          </template>\n        </li>\n      </ul>\n    </div>\n  </div>\n</template>\n\n<script>\n\nconst tf = require('@tensorflow/tfjs');\n\nexport default {\n  name: 'App',\n  data() {\n    return {\n      ctx: null,\n      worldWidth: 256,\n      worldHeight: 256,\n      imgWorld: null,\n      worldLoaded: false,\n      fps: null,\n      fpsCounter: null,\n      tick: true,\n      tickTime: null,\n      duration: -1,\n      durationString: null,\n      car: {\n        width: 8,\n        length: 16,\n        x: 256 / 2 * 0.25,\n        y: 256 / 2 * 1.5,\n        speed: 0.5,\n        steeringSpeed: 0.025,\n        angle: 0\n      },\n      viewSize: 32,\n      viewReduction: 3,\n      viewReducedSize: null,\n      viewPixels: null,\n      steering: null,\n      samples: [],\n      samplesMaxLength: 4096,\n      trainingSamples: null,\n      trainingSamplesMaxLength: 4096,\n      badRewards: 0,\n      badRewardsInARow: 0,\n      score: 0,\n      lastScore: null,\n      highscores: [],\n      highscoresMaxLength: 10,\n      highscoresMaxShown: 10,\n      training: false,\n      trainingProgress: 0,\n      models: undefined,\n      numberOfModels: 10,\n      modelIndex: 0\n    }\n  },\n  computed: {\n    reducedViewSize() {\n      let reducedSize = this.viewSize;\n      for( let i = 0; i < this.viewReduction; i++ ) {\n        reducedSize = reducedSize / 2;\n      }\n      return reducedSize;\n    },\n    highscoresShown() {\n      return this.highscores.slice(0,this.highscoresMaxShown);\n    }\n  },\n  mounted() {\n    this.ctx = this.$refs.canvas.getContext(\"2d\");\n    this.imgWorld = new Image(this.worldWidth,this.worldHeight);\n    this.imgWorld.src = require('/src/assets/world4.jpg');\n    const app = this;\n    this.imgWorld.onload = function() {\n      app.worldLoaded = true;\n    }\n    //document.addEventListener('keydown', this.keyDown);\n    //document.addEventListener('keyup', this.keyUp);\n\n    this.ctxViewSnapshot = this.$refs.viewSnapshotCanvas.getContext(\"2d\");\n    this.ctxCarSnapshot = this.$refs.carSnapshotCanvas.getContext(\"2d\");\n\n    this.ctxCar = this.$refs.carCanvas.getContext(\"2d\");\n    this.ctxView = this.$refs.viewCanvas.getContext(\"2d\");\n    this.ctxViewReduced = this.$refs.viewCanvasReduced.getContext(\"2d\");\n\n    this.ctxStats = this.$refs.statsCanvas.getContext(\"2d\");\n\n\n    this.viewReducedSize = this.viewSize;\n    for( let i = 0; i < this.viewReduction; i++ ) {\n      this.viewReducedSize = this.viewReducedSize / 2;\n    }\n\n    this.models = new Array(this.numberOfModels);\n    this.createModel(this.modelIndex);\n\n    this.refreshLoop();\n  },\n  methods: {\n    createModel( modelIndex ) {\n      console.log(\"creating model ...\");\n      const numberOfLayers =  2 + Math.round(Math.random());\n      let layers = new Array( numberOfLayers );\n      for( let i = numberOfLayers-1; i >= 0; i-- ) {\n        if( i === numberOfLayers-1 ) {\n          // last layer\n          layers[i] = {\n            units: 1,\n            activation: \"sigmoid\"\n          };\n        }\n        else {\n          layers[i] = {\n            units: 3 + Math.ceil( Math.random()*15 ),\n            activation: [\"relu\",\"sigmoid\"][Math.round(Math.random())]\n          };\n        }\n      }\n      this.models[modelIndex] = {\n        layers: layers,\n        trainings: 0,\n        highscore: undefined,\n        name: modelIndex+1,\n        children: 0\n      };\n\n      // create model with layers\n      this.models[modelIndex].model = tf.sequential();\n      for( let i = 0; i < layers.length; i++ ) {\n        if( i === 0 ) {\n          // first layer\n          this.models[modelIndex].model.add(tf.layers.dense({inputShape: this.viewReducedSize*this.viewReducedSize, activation: layers[i].activation, units: layers[i].units}));\n        }\n        else {\n          this.models[modelIndex].model.add(tf.layers.dense({activation: layers[i].activation, units: layers[i].units}));\n        }\n      }\n      /*\n      this.models[i].model.add(tf.layers.dense({inputShape: this.viewReducedSize*this.viewReducedSize, activation: \"relu\", units: 10}));\n      this.models[i].model.add(tf.layers.dense({activation: \"relu\", units: 5}));\n      this.models[i].model.add(tf.layers.dense({activation: \"sigmoid\", units: 1}));\n      */\n      //this.models[i].add(tf.layers.dense({activation: \"relu\", units: 1}));\n      this.models[modelIndex].model.compile({loss:'binaryCrossentropy',optimizer:tf.train.rmsprop(0.1),metrics:['accuracy']});\n      //this.model.compile({loss:'categoricalCrossentropy',optimizer:tf.train.adam(),metrics:['accuracy']});\n    },\n    async train() {\n\n      // check if new highscore:\n      let highscoreOfModel = this.highscores.find(el => el.modelIndex === this.modelIndex );\n      if( highscoreOfModel ) {\n        this.models[this.modelIndex].highscore = highscoreOfModel.score;\n      }\n\n      // switch to next model\n      this.modelIndex = (this.modelIndex +1) % this.numberOfModels;\n\n      // create or make clone, if necessary\n      if( !this.models[this.modelIndex] ) {\n        this.createModel(this.modelIndex);\n      }\n      else {\n        // check for new highscore\n        let highscoreOfModel = this.highscores.find(el => el.modelIndex === this.modelIndex );\n        if( !highscoreOfModel ) {\n          // replace model\n\n          let random = Math.random();\n          let highscoreIndex;\n          if( random > 1-0.182 ) {\n            highscoreIndex = 0;\n          }\n          else if( random > 1 - 0.182 - 0.163) {\n            highscoreIndex = 1;\n          }\n          else if( random > 1 - 0.182 - 0.163 - 0.146 ) {\n            highscoreIndex = 2;\n          }\n          else if( random > 1 - 0.182 - 0.163 - 0.146 - 0.127 ) {\n            highscoreIndex = 3;\n          }\n          else if( random > 1 - 0.182 - 0.163 - 0.146 - 0.127 - 0.109 ) {\n            highscoreIndex = 4;\n          }\n          else if( random > 1 - 0.182 - 0.163 - 0.146 - 0.127 - 0.109 - 0.091 ) {\n            highscoreIndex = 5;\n          }\n          else if( random > 1 - 0.182 - 0.163 - 0.146 - 0.127 - 0.109 - 0.091 - 0.073 ) {\n            highscoreIndex = 6;\n          }\n          else if( random > 1 - 0.182 - 0.163 - 0.146 - 0.127 - 0.109 - 0.091 - 0.073 - 0.054 ) {\n            highscoreIndex = 7;\n          }\n          else if( random > 1 - 0.182 - 0.163 - 0.146 - 0.127 - 0.109 - 0.091 - 0.073 - 0.054 - 0.037 ) {\n            highscoreIndex = 8;\n          }\n          else if( random > 1 - 0.182 - 0.163 - 0.146 - 0.127 - 0.109 - 0.091 - 0.073 - 0.054 - 0.037 - 0.018 ) {\n            highscoreIndex = 9;\n          }\n\n          const mother = this.models[ this.highscores[highscoreIndex].modelIndex ];\n          this.models[this.modelIndex] = {...mother};\n          this.models[this.modelIndex].trainings = 0;\n          this.models[this.modelIndex].highscore = undefined;\n          mother.children++;\n          this.models[this.modelIndex].name = mother.name+\".\"+mother.children;\n        }\n\n      }\n\n      this.training = true;\n\n      this.trainingSamples = [];\n      for( let i = 0; i < this.highscores.length; i++ ) {\n        let samples = [];\n        for( let j = 0; j < this.highscores[i].samples.length; j++ ) {\n          if( this.highscores[i].samples[j].reward > 0.5 ) {\n            // use only good rewards\n            samples.push( this.highscores[i].samples[j] );\n          }\n        }\n        this.trainingSamples.push(...samples);\n      }\n      // randomise and slice\n      this.trainingSamples.sort(function(){return 0.5 - Math.random()});\n      this.trainingSamples = this.trainingSamples.slice(0,this.trainingSamplesMaxLength);\n\n      console.log(\"total number of samples: \"+this.trainingSamples.length);\n\n      let featureValuesTraining = [];\n      let labelValuesTraining = [];\n      for( let i = 0; i < this.trainingSamples.length; i++ ) {\n        let featureValueTraining = [...this.trainingSamples[i].state];\n        //featureValueTraining.push( this.trainingSamples[i].reward );\n        featureValuesTraining.push( featureValueTraining );\n        labelValuesTraining.push( this.trainingSamples[i].action );\n      }\n      const featureTensorTraining = tf.tensor2d( featureValuesTraining, [featureValuesTraining.length, featureValuesTraining[0].length] );\n      const labelTensorTraining = tf.tensor2d( labelValuesTraining, [labelValuesTraining.length, 1] );\n\n      console.log(\"train model ...\");\n      await this.trainModel( this.modelIndex, featureTensorTraining, labelTensorTraining, Math.min(10, this.trainingSamplesMaxLength/this.trainingSamples.length)*10 );\n\n      this.training = false;\n      this.trainingProgress = 0;\n\n      this.models[this.modelIndex].trainings += 1;\n    },\n    async trainModel( modelIndex, featureTensorTraining, labelTensorTraining, epochs ) {\n      const ref = this;\n      return this.models[modelIndex].model.fit( featureTensorTraining, labelTensorTraining, {\n        epochs,\n        //validationSplit: 0.2,\n        callbacks: {\n          onEpochEnd: function(epoch) {\n            ref.trainingProgress = Math.round( epoch / epochs * 100 );\n          },\n          onTrainEnd: function() {\n            console.log(\"done\");\n          }\n        }\n      });\n    },\n    async predict( modelIndex, input ) {\n      return tf.tidy( () => {\n        const inputTensor = tf.tensor2d([input],[1, this.viewReducedSize*this.viewReducedSize]);\n        const outputTensor = this.models[modelIndex].model.predict( inputTensor );\n        const outputValue = outputTensor.dataSync();\n\n        return outputValue;\n      });\n    },\n    async getSteering() {\n      this.prediction = await this.predict( this.modelIndex, this.testingDataInput );\n      this.prediction = Math.max( 0, this.prediction  )\n      return this.prediction;\n    },\n    refreshLoop() {\n      window.requestAnimationFrame(() => {\n        const now = performance.now();\n        if( this.tick ) {\n          this.tickTime = now;\n          this.fps = this.fpsCounter;\n          this.fpsCounter = 0;\n          this.tick = false;\n\n          this.duration++;\n          const date = new Date(0);\n          date.setSeconds(this.duration); // specify value for SECONDS here\n          this.durationString = date.toISOString().substr(11, 8);\n        }\n        else {\n          this.fpsCounter++;\n          if( now >= this.tickTime + 1000 ) {\n            this.tick = true;\n          }\n        }\n\n        this.enterFrame();\n\n        this.refreshLoop();\n      });\n    },\n    enterFrame() {\n      if( this.worldLoaded && !this.training ) {\n        this.drawWorld();\n        this.getView();\n        this.moveCar();\n      }\n    },\n    drawStats() {\n      this.ctxStats.clearRect( 0, 0, this.ctxStats.canvas.width, this.ctxStats.canvas.height );\n      //this.ctxStats.fillRect(0, 0, this.ctxStats.canvas.width, this.ctxStats.canvas.height);\n      //this.ctxStats.strokeStyle = \"#ffffff\";\n      const numberOfsamplesDrawn = Math.min(512, this.samples.length);\n      for( let i = 0; i < numberOfsamplesDrawn; i++ ) {\n        /*\n        this.ctxStats.moveTo( this.samples[i].action * this.ctxStats.canvas.width, this.ctxStats.canvas.height/this.samples.length * i );\n        this.ctxStats.lineTo( this.samples[i+1].action * this.ctxStats.canvas.width, this.ctxStats.canvas.height/this.samples.length * (i+1) );\n        */\n        this.ctxStats.beginPath();\n        this.ctxStats.fillStyle = \"#ffffff\";\n        this.ctxStats.arc(this.samples[i].actionPredicted * this.ctxStats.canvas.width, this.ctxStats.canvas.height/numberOfsamplesDrawn * i, 1, 0, 2 * Math.PI);\n        this.ctxStats.fill();\n\n        this.ctxStats.beginPath();\n        let rgb;\n        if( this.samples[i].reward >= 0.5 ) {\n          //rgb = \"#00ff00\";\n          rgb = \"#00\"+ Math.round( this.samples[i].reward * 255 ).toString(16) + \"00\";\n          this.ctxStats.fillStyle = rgb;\n          this.ctxStats.arc(this.samples[i].action * this.ctxStats.canvas.width, this.ctxStats.canvas.height/numberOfsamplesDrawn * i, 1, 0, 2 * Math.PI);\n          this.ctxStats.fill();\n        }\n        else {\n          //rgb = \"#ff0000\";\n          rgb = \"#\"+ Math.round( (1-this.samples[i].reward) * 255 ).toString(16) + \"0000\";\n          this.ctxStats.fillStyle = rgb;\n          this.ctxStats.arc(this.samples[i].action * this.ctxStats.canvas.width, this.ctxStats.canvas.height/numberOfsamplesDrawn * i, 1, 0, 2 * Math.PI);\n          this.ctxStats.fill();\n        }\n      }\n      //this.ctxStats.stroke();\n    },\n    moveCar() {\n      this.testingDataInput = [...this.viewPixels];\n      //this.testingDataInput.push(1.0);\n      const ref = this;\n      this.getSteering().then( function(value) {\n        //console.log(\"predicted steering: \"+value);\n        value = Math.min( value, 1 );\n        value = Math.max( value, 0 );\n        //console.log(\"predicted steering: \"+value);\n        ref.car.steeringPredicted = value;\n\n        let randomisation = 0;\n        if( ref.samples[0] ) {\n          if( ref.samples[0].reward < 0.5 ) {\n            randomisation = Math.min( 0.75, (ref.badRewards/ref.samples.length) * ref.badRewardsInARow );\n          }\n          else {\n            randomisation = 0.05;\n          }\n        }\n        else {\n          randomisation = 0.75;\n        }\n\n        //console.log(\"randomisation: \"+randomisation);\n        const random = Math.random();\n        let randomisedValue = value - randomisation*1 + random * randomisation*2;\n        randomisedValue = Math.min( randomisedValue, 1 );\n        randomisedValue = Math.max( randomisedValue, 0 );\n        ref.car.steering = randomisedValue;\n        //console.log(\"new steering: \"+randomisedValue);\n\n        if( ref.car.steering < 0.5 ) {\n          // left\n          const steeringStrength = (0.5 - ref.car.steering) * 2\n          ref.car.angle -= ref.car.steeringSpeed * steeringStrength;\n        }\n        else if( ref.car.steering > 0.5 ){\n          // right\n          const steeringStrength = (ref.car.steering - 0.5) * 2\n          ref.car.angle += ref.car.steeringSpeed * steeringStrength;\n        }\n\n        ref.car.x += Math.sin( ref.car.angle ) *ref.car.speed;\n        ref.car.y -= Math.cos( ref.car.angle ) *ref.car.speed;\n\n        ref.checkCarCollision();\n      });\n    },\n    getView() {\n      // view\n      this.car.viewX = this.car.x + Math.sin( this.car.angle ) * (this.car.length*0+this.viewSize/2);\n      this.car.viewY = this.car.y - Math.cos( this.car.angle ) * (this.car.length*0+this.viewSize/2);\n      // get view image\n      this.snapshotWhereViewIs = this.ctx.getImageData( this.car.viewX - this.ctxViewSnapshot.canvas.width/2, this.car.viewY - this.ctxViewSnapshot.canvas.height/2, this.ctxViewSnapshot.canvas.width, this.ctxViewSnapshot.canvas.height );\n      // read pixels\n      let viewSnapshotPixels = [];\n      for( let i = 0; i < this.snapshotWhereViewIs.data.length; i += 4 ) {\n        const r = this.snapshotWhereViewIs.data[i];\n        const g = this.snapshotWhereViewIs.data[i+1];\n        const b = this.snapshotWhereViewIs.data[i+2];\n        viewSnapshotPixels.push( [r,g,b] );\n      }\n      // draw rotated image\n      this.ctxViewSnapshot.save();\n      this.ctxViewSnapshot.clearRect( 0, 0, this.ctxViewSnapshot.canvas.width, this.ctxViewSnapshot.canvas.height );\n      this.ctxViewSnapshot.translate( this.ctxViewSnapshot.canvas.width/2, this.ctxViewSnapshot.canvas.height/2 );\n      this.ctxViewSnapshot.rotate( -this.car.angle );\n      this.ctxViewSnapshot.translate( -this.ctxViewSnapshot.canvas.width/2, -this.ctxViewSnapshot.canvas.height/2 );\n      for( let y = 0; y < this.ctxViewSnapshot.canvas.height; y++ ) {\n        for( let x = 0; x < this.ctxViewSnapshot.canvas.width; x++ ) {\n          const pixelIndex = y*this.ctxViewSnapshot.canvas.width + x;\n          const color = this.rgbToHex( viewSnapshotPixels[pixelIndex][0], viewSnapshotPixels[pixelIndex][1], viewSnapshotPixels[pixelIndex][2] );\n          this.ctxViewSnapshot.fillStyle = color;\n          this.ctxViewSnapshot.fillRect( x, y, 1.5, 1.5 );\n        }\n      }\n      this.ctxViewSnapshot.restore();\n      // get view image\n      this.imgWhereViewIs = this.ctxViewSnapshot.getImageData( this.ctxViewSnapshot.canvas.width/2 - this.ctxView.canvas.width/2, this.ctxViewSnapshot.canvas.height/2 - this.ctxView.canvas.height/2, this.ctxView.canvas.width, this.ctxView.canvas.height );\n      this.ctxView.putImageData(this.imgWhereViewIs, 0, 0);\n      // read pixels\n      let viewPixels = [];\n      for( let i = 0; i < this.imgWhereViewIs.data.length; i += 4 ) {\n        const r = this.imgWhereViewIs.data[i];\n        const g = this.imgWhereViewIs.data[i+1];\n        const b = this.imgWhereViewIs.data[i+2];\n        viewPixels.push( [r,g,b] );\n      }\n      let viewPixelsReduced = viewPixels;\n      for( let i = 0; i < this.viewReduction; i++ ) {\n        viewPixelsReduced = this.reducePixels( viewPixelsReduced, Math.sqrt(viewPixelsReduced.length) );\n      }\n      // draw reduced view\n      for( let y = 0; y < this.ctxViewReduced.canvas.height; y++ ) {\n        for( let x = 0; x < this.ctxViewReduced.canvas.width; x++ ) {\n          const pixelIndex = y*this.ctxViewReduced.canvas.width + x;\n          const color = this.rgbToHex( viewPixelsReduced[pixelIndex][0], viewPixelsReduced[pixelIndex][1], viewPixelsReduced[pixelIndex][2] );\n          this.ctxViewReduced.fillStyle = color;\n          this.ctxViewReduced.fillRect( x, y, 1.5, 1.5 );\n        }\n      }\n\n      let previousTotalBrightness;\n      // create sample\n      if( this.viewPixels ) {\n        // has previous state\n        this.samples.unshift( {\n          state: this.viewPixels,\n          action: this.car.steering,\n          actionPredicted: this.car.steeringPredicted\n        } );\n        //this.samples = this.samples.slice(0,this.samplesMaxLength);\n        previousTotalBrightness = this.totalBrightness;\n      }\n\n      // save new view pixels\n      this.viewPixels = [];\n      this.totalBrightness = 0;\n      for( let i = 0; i < viewPixelsReduced.length; i++ ) {\n        const brightness = (viewPixelsReduced[i][0] + viewPixelsReduced[i][1] + viewPixelsReduced[i][2]) / 765;\n        this.viewPixels.push( brightness );\n        this.totalBrightness += brightness;\n      }\n      this.totalBrightness = this.totalBrightness / this.viewPixels.length;\n\n      if( this.samples.length ) {\n        const brightnessChange = this.totalBrightness - previousTotalBrightness;\n        console.log(\"---\");\n        //console.log( \"totalBrightness: \"+ this.totalBrightness );\n        //console.log( \"previousTotalBrightness: \"+ previousTotalBrightness );\n        //console.log( \"brightnessChange: \"+ brightnessChange );\n        let reward;\n        if( brightnessChange >= 0 ) {\n          // better\n          /*\n          if( this.totalBrightness > 0.5 ) {\n            // not so bad situation\n            reward = 1;\n          }\n          else {\n            // bad situation\n            reward = 0.75 + Math.min( 0.25, brightnessChange*10 * this.totalBrightness );\n          }\n          */\n          reward = 1;\n          //console.log(reward+\": better\");\n        }\n        else {\n          /*\n          // worse\n          if( this.totalBrightness < 0.5 ) {\n            // bad situation\n            reward = 0;\n          }\n          else {\n            // bad situation\n            reward = Math.min( 0.25, Math.abs(brightnessChange)*10 * this.totalBrightness );\n          }\n          */\n          reward = 0;\n          //console.log(reward+\": worse\");\n        }\n        this.samples[0].reward = reward;\n\n\n        // calculate total accuarcy\n        if( reward < 0.5 ) {\n          this.badRewards++;\n          this.badRewardsInARow++;\n        }\n        else {\n          this.badRewardsInARow = 0;\n        }\n\n\n        // trim samples:\n        if( this.samples.length === this.samplesMaxLength ) {\n          //console.log(\"max length reached: \"+this.samples.length);\n          if( this.samples[this.samples.length-1].reward < 0.5 ) {\n            //console.log(\"last is badReward\");\n            this.badRewards--;\n          }\n          //console.log(\"remove\");\n          this.samples = this.samples.slice(0,this.samplesMaxLength-1);\n          //console.log(\"new length: \" +this.samples.length);\n        }\n        console.log( \"good samples: \"+(this.samples.length-this.badRewards) +\" of \"+this.samples.length);\n\n      }\n      else {\n        // first cycle\n        this.badRewards = 0;\n        this.badRewardsInARow = 0;\n      }\n\n    },\n    checkCarCollision() {\n      // get car image\n      this.snapshotWhereCarIs = this.ctx.getImageData( this.car.x - this.ctxCarSnapshot.canvas.width/2, this.car.y - this.ctxCarSnapshot.canvas.height/2, this.ctxCarSnapshot.canvas.width, this.ctxCarSnapshot.canvas.height );\n      // read pixels\n      let carSnapshotPixels = [];\n      for( let i = 0; i < this.snapshotWhereCarIs.data.length; i += 4 ) {\n        const r = this.snapshotWhereCarIs.data[i];\n        const g = this.snapshotWhereCarIs.data[i+1];\n        const b = this.snapshotWhereCarIs.data[i+2];\n        carSnapshotPixels.push( [r,g,b] );\n      }\n      // draw rotated image\n      this.ctxCarSnapshot.save();\n      this.ctxCarSnapshot.clearRect( 0, 0, this.ctxCarSnapshot.canvas.width, this.ctxCarSnapshot.canvas.height );\n      this.ctxCarSnapshot.translate( this.ctxCarSnapshot.canvas.width/2, this.ctxCarSnapshot.canvas.height/2 );\n      this.ctxCarSnapshot.rotate( -this.car.angle );\n      this.ctxCarSnapshot.translate( -this.ctxCarSnapshot.canvas.width/2, -this.ctxCarSnapshot.canvas.height/2 );\n      for( let y = 0; y < this.ctxCarSnapshot.canvas.height; y++ ) {\n        for( let x = 0; x < this.ctxCarSnapshot.canvas.width; x++ ) {\n          const pixelIndex = y*this.ctxCarSnapshot.canvas.width + x;\n          const color = this.rgbToHex( carSnapshotPixels[pixelIndex][0], carSnapshotPixels[pixelIndex][1], carSnapshotPixels[pixelIndex][2] );\n          this.ctxCarSnapshot.fillStyle = color;\n          this.ctxCarSnapshot.fillRect( x, y, 1.5, 1.5 );\n        }\n      }\n      this.ctxCarSnapshot.restore();\n      // get car image\n      this.imgWhereCarIs = this.ctxCarSnapshot.getImageData( this.ctxCarSnapshot.canvas.width/2 - this.ctxCar.canvas.width/2, this.ctxCarSnapshot.canvas.height/2 - this.ctxCar.canvas.height/2, this.ctxCar.canvas.width, this.ctxCar.canvas.height );\n      this.ctxCar.putImageData(this.imgWhereCarIs, 0, 0);\n\n\n\n      this.drawCarAndViewSquare();\n\n\n      // read pixels\n      let totalR = 0;\n      let totalG = 0;\n      let totalB = 0;\n      for( let i = 0; i < this.imgWhereCarIs.data.length; i += 4 ) {\n        totalR += this.imgWhereCarIs.data[i];\n        totalG += this.imgWhereCarIs.data[i+1];\n        totalB += this.imgWhereCarIs.data[i+2];\n      }\n      totalR = Math.round( totalR / (this.imgWhereCarIs.data.length /4) );\n      totalG = Math.round( totalG / (this.imgWhereCarIs.data.length /4) );\n      totalB = Math.round( totalB / (this.imgWhereCarIs.data.length /4) );\n      if( totalR + totalG + totalB < 760 ) {\n        console.log(\"collision!\");\n\n        this.viewPixels = null;\n        this.car.steering = undefined;\n        this.resetCar();\n\n        if( this.highscores.length < this.highscoresMaxLength || this.score > this.highscores[this.highscoresMaxLength-1].score ) {\n          console.log(\"new highscore\");\n\n          this.highscores.push( {\n            score: this.score,\n            samples: [...this.samples],\n            modelIndex: this.modelIndex\n          } );\n          this.highscores.sort(function(a, b){return b.score - a.score});\n          this.highscores = this.highscores.slice(0,this.highscoresMaxLength);\n        }\n        console.log(\"train\");\n        this.train();\n\n        this.drawStats();\n\n        this.samples = [];\n        this.lastScore = this.score;\n        this.score = 0;\n\n        //this.refreshLoop = null;\n      }\n      else {\n        this.score++;\n        this.drawStats();\n      }\n    },\n    drawCarAndViewSquare() {\n      // draw car\n      this.ctx.save();\n      this.ctx.translate( this.car.x, this.car.y );\n      this.ctx.rotate( this.car.angle );\n      this.ctx.translate( -this.car.x, -this.car.y );\n      this.ctx.fillRect( this.car.x -this.car.width/2, this.car.y -this.car.length/2, this.car.width, this.car.length );\n      this.ctx.restore();\n\n      // draw view rect\n      this.ctx.save();\n      this.ctx.translate( this.car.viewX, this.car.viewY );\n      this.ctx.rotate( this.car.angle );\n      this.ctx.translate( -this.car.viewX, -this.car.viewY );\n      this.ctx.strokeStyle = \"#ff0000\";\n      this.ctx.beginPath();\n      this.ctx.rect( this.car.viewX -this.ctxView.canvas.width/2, this.car.viewY -this.ctxView.canvas.height/2, this.ctxView.canvas.width, this.ctxView.canvas.height );\n      this.ctx.stroke();\n      this.ctx.restore();\n    },\n    componentToHex(c) {\n      var hex = c.toString(16);\n      return hex.length == 1 ? \"0\" + hex : hex;\n    },\n    rgbToHex(r, g, b) {\n      return \"#\" + this.componentToHex(r) + this.componentToHex(g) + this.componentToHex(b);\n    },\n    reducePixels(pixels,size) {\n      // reduce resolution\n      let pixelsReduced = [];\n      for( let y = 0; y < size; y+=2 ) {\n        for( let x = 0; x < size; x+=2 ) {\n          const pixelIndexes = [\n            y*size + x,\n            y*size + x +1,\n            (y+1)*size + x,\n            (y+1)*size + x +1,\n          ];\n\n          let totalR = 0;\n          let totalG = 0;\n          let totalB = 0;\n          for( let i = 0; i < pixelIndexes.length; i++ ) {\n            totalR += pixels[pixelIndexes[i]][0];\n            totalG += pixels[pixelIndexes[i]][1];\n            totalB += pixels[pixelIndexes[i]][2];\n          }\n          totalR = Math.round( totalR / pixelIndexes.length );\n          totalG = Math.round( totalG / pixelIndexes.length );\n          totalB = Math.round( totalB / pixelIndexes.length );\n          pixelsReduced.push( [totalR,totalG,totalB] );\n        }\n      }\n      return pixelsReduced;\n    },\n    drawWorld() {\n      this.ctx.clearRect( 0, 0, this.ctx.canvas.width, this.ctx.canvas.height );\n      this.ctx.drawImage( this.imgWorld, 0, 0, this.ctx.canvas.width, this.ctx.canvas.height );\n    },\n    resetCar() {\n      console.log( \"reset car\");\n      this.car.x = this.worldWidth / 2 * 0.25;\n      this.car.y = this.worldHeight / 2 * 1.5;\n      this.car.angle = 0;\n    },\n    /*\n    keyDown(e) {\n      if( e.code === \"ArrowLeft\" ) {\n        this.car.steering = 0;\n      }\n      else if( e.code === \"ArrowRight\" ) {\n        this.car.steering = 1;\n      }\n    },\n    keyUp(e) {\n      if( e.code === \"ArrowLeft\" ) {\n        this.car.steering = undefined;\n      }\n      else if( e.code === \"ArrowRight\" ) {\n        this.car.steering = undefined;\n      }\n    }\n    */\n  }\n}\n</script>\n\n<style lang=\"scss\">\n\nbody {\n  margin: 0;\n  height: 100vh;\n  font-family: sans-serif;\n  font-size: 16px;\n  line-height: 150%;\n  background-color: black;\n  color: white;\n}\nlabel {\n  font-size: 13px;\n}\n#app {\n  height: 100%;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  margin: auto;\n  max-width: 100vh;\n}\n\n.world {\n  position: relative;\n  width: 100%;\n  height: 0;\n  padding-top: 100%;\n  .world-canvas {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n  }\n  .training {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 20%;\n    height: 20%;\n    position: absolute;\n    top: 40%;\n    left: 40%;\n    span {\n      text-align: center;\n    }\n  }\n}\n\n\n.car-snapshot-canvas {\n  position: absolute;\n  top: 8px;\n  left: 8px;\n  border: 1px solid white;\n  image-rendering: pixelated;\n  width: 10%;\n  display: none;\n}\n.car-canvas {\n  position: absolute;\n  bottom: 8px;\n  left: 8px;\n  border: 1px solid white;\n  image-rendering: pixelated;\n  width: 15%;\n  display: none;\n}\n.view-snapshot-canvas {\n  position: absolute;\n  top: 8px;\n  right: 8px;\n  border: 1px solid white;\n  image-rendering: pixelated;\n  width: 10%;\n  display: none;\n}\n.view-canvas {\n  position: absolute;\n  bottom: 8px;\n  right: 8px;\n  border: 1px solid white;\n  image-rendering: pixelated;\n  width: 10%;\n  display: none;\n}\n.view-canvas-reduced {\n  position: absolute;\n  bottom: 8px;\n  right: 8px;\n  border: 1px solid red;\n  image-rendering: pixelated;\n  width: 15%;\n}\n\n\n\n.fps {\n  position: absolute;\n  top: 8px;\n  left: 50%;\n  color: #333333;\n}\n\n.highscores {\n  position: absolute;\n  top: 16px;\n  right: 16px;\n  text-align: right;\n\n  .duration {\n    margin-bottom: 16px;\n  }\n\n  label {\n    display: block;\n    font-weight: bold;\n    margin-bottom: 8px;\n  }\n  ul {\n    list-style: none;\n    margin: 0;\n    padding: 0;\n    li {\n      &:first-child {\n        font-size: 20px;\n        line-height: 150%;\n      }\n      &:nth-child(2),\n      &:nth-child(3) {\n        font-size: 16px;\n        line-height: 20px;\n      }\n      display: block;\n      font-size: 13px;\n      line-height: 16px;\n    }\n  }\n\n}\n\n\n.score {\n  position: absolute;\n  right: calc( 15% + 48px);\n  bottom: 48px;\n  text-align: right;\n  label {\n    display: block;\n    font-weight: bold;\n    margin-bottom: 8px;\n  }\n\n  .last {\n    margin-top: 16px;\n    font-size: 25px;\n    label {\n      font-size: 16px;\n    }\n  }\n}\n\n.stats {\n  position: absolute;\n  top: 0;\n  left: 0;\n  height: 100%;\n  .stats-canvas {\n    height: 100%;\n    border-right: 1px solid #333;\n  }\n  &:before {\n    content: '';\n    position: absolute;\n    display: block;\n    width: 50%;\n    height: 100%;\n    border-right: 1px solid #666666;\n  }\n}\n\n.models {\n  position: absolute;\n  top: 0;\n  left: 7.5%;\n  label {\n    display: block;\n    font-weight: bold;\n    margin-bottom: 8px;\n  }\n  ul {\n    list-style: none;\n    padding: 0;\n    margin: 0;\n    li {\n      color: #cccccc;\n      font-size: 13px;\n      line-height: 125%;\n      &.active {\n        font-weight: bold;\n        font-size: 25px;\n      }\n      .layers {\n        font-size: 10px;\n      }\n    }\n  }\n}\n\n</style>\n"]}]}